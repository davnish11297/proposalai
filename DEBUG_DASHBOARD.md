# ðŸ”§ Dashboard API Debug Instructions\n\n## Current Issue: Dashboard API 500 Error\n\nThe dashboard is still returning a 500 error. Here's how to debug and fix it:\n\n### 1. Quick Tests to Run:\n\n#### Test 1: Check if basic API works\n```bash\n# In browser console or new tab:\nhttp://localhost:3000/api/test\n```\n**Expected:** Should return `{\"success\": true, \"message\": \"API is working\"}`\n\n#### Test 2: Check authentication\n```bash\n# In browser console:\nfetch('/api/test', {\n  headers: {\n    'Authorization': `Bearer ${localStorage.getItem('token')}`\n  }\n}).then(r => r.json()).then(console.log)\n```\n\n#### Test 3: Check MongoDB connection\nLook at your server console (where you run `npm run dev`) for any MongoDB connection errors.\n\n### 2. Debugging Steps:\n\n#### Step 1: Check Server Console\nLook at your terminal where `npm run dev` is running. You should see:\n```\nDashboard API called\nDashboard API: User authenticated: [userId]\nDashboard API: Database connected\n```\n\nIf you don't see these logs, the API isn't being reached properly.\n\n#### Step 2: Check Browser Network Tab\n1. Open browser DevTools (F12)\n2. Go to Network tab\n3. Refresh dashboard page\n4. Look for the `/api/dashboard` request\n5. Check the Response tab for error details\n\n#### Step 3: Check Environment Variables\nMake sure your `.env.local` file has:\n```bash\nMONGODB_URI=your_mongodb_connection_string\nJWT_SECRET=your_jwt_secret\n```\n\n### 3. Quick Fixes to Try:\n\n#### Fix 1: Restart Development Server\n```bash\n# Stop the server (Ctrl+C)\n# Then restart:\nnpm run dev\n```\n\n#### Fix 2: Clear Browser Cache\n```bash\n# Hard refresh:\nCtrl+Shift+R (Windows/Linux)\nCmd+Shift+R (Mac)\n```\n\n#### Fix 3: Check if logged in properly\n```bash\n# In browser console:\nconsole.log('Token:', localStorage.getItem('token'))\n```\nIf no token, try logging out and logging back in.\n\n### 4. If Still Not Working:\n\n#### Option 1: Use Original Dashboard\n```javascript\n// In browser console:\nlocalStorage.setItem('dashboardMode', 'original')\n// Then refresh page\n```\n\n#### Option 2: Check MongoDB Connection\nMake sure:\n1. MongoDB is running (if local)\n2. Connection string is correct\n3. Database has data (at least one user and organization)\n\n### 5. Common Issues & Solutions:\n\n#### Issue: \"No authentication token found\"\n**Solution:** Log out and log back in\n\n#### Issue: \"Cannot connect to MongoDB\"\n**Solution:** Check MONGODB_URI in .env.local\n\n#### Issue: \"User not found\"\n**Solution:** Register a new user or check database\n\n#### Issue: \"OrganizationId undefined\"\n**Solution:** Make sure user has organizationId in database\n\n### 6. Emergency Fallback:\n\nIf dashboard still won't load, you can:\n\n1. **Use original dashboard:**\n   ```javascript\n   localStorage.setItem('dashboardMode', 'original')\n   ```\n\n2. **Or go directly to other pages:**\n   - `/drafts` - View draft proposals\n   - `/clients` - Manage clients\n   - `/sent-proposals` - View sent proposals\n\n### 7. What to Check in Server Console:\n\nLook for these specific error messages:\n- `MongoDB connection error`\n- `JWT verification failed`\n- `User not found`\n- `organizationId is undefined`\n- `Cannot read property of undefined`\n\n### 8. Report Back:\n\nAfter trying these steps, please share:\n1. What you see in the server console (terminal)\n2. What you see in browser Network tab for `/api/dashboard`\n3. Result of the test API call (`/api/test`)\n4. Your browser console errors (if any new ones)\n\nThis will help pinpoint the exact issue! ðŸš€\n\n---\n\n*The dashboard API has been significantly simplified and should work now. If it still doesn't, there's likely an environment or configuration issue.*", "oldText": ""}]