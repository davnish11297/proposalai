{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{useParams,useSearchParams}from'react-router-dom';import{CheckCircleIcon,XCircleIcon,ChatBubbleLeftIcon,LockClosedIcon,ArrowRightIcon,DocumentTextIcon,UserIcon,CalendarIcon,BuildingOfficeIcon}from'@heroicons/react/24/outline';import toast from'react-hot-toast';import{publicAPI}from'../services/api';import PublicComments from'../components/PublicComments';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";// Reusable Request Access Form Component\nconst RequestAccessForm=_ref=>{let{onSubmit,requestAccessData,setRequestAccessData,submittingRequest,onCancel,isFullPage=false,simplified=false}=_ref;const formContent=/*#__PURE__*/_jsxs(\"div\",{className:`bg-white rounded-lg p-6 ${isFullPage?'max-w-md w-full':'max-w-md mx-auto'}`,children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Request Access\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mb-4\",children:simplified?\"Need to review this proposal again? Let us know why you need access.\":\"Need to review this proposal again? Request access from the proposal owner.\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,className:\"space-y-4\",children:[!simplified&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Your Name *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",required:!simplified,value:requestAccessData.name,onChange:e=>setRequestAccessData({...requestAccessData,name:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\",placeholder:\"Enter your full name\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Email Address *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",required:!simplified,value:requestAccessData.email,onChange:e=>setRequestAccessData({...requestAccessData,email:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\",placeholder:\"Enter your email address\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Company\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:requestAccessData.company,onChange:e=>setRequestAccessData({...requestAccessData,company:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\",placeholder:\"Enter your company name\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:[\"Reason for Access \",simplified&&'*']}),/*#__PURE__*/_jsx(\"textarea\",{required:simplified,value:requestAccessData.reason,onChange:e=>setRequestAccessData({...requestAccessData,reason:e.target.value}),rows:3,className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\",placeholder:\"Why do you need access to this proposal?\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:submittingRequest,className:\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed\",children:submittingRequest?/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center justify-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}),\"Sending Request...\"]}):'Request Access'}),onCancel&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onCancel,className:\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition\",children:\"Cancel\"})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-4 text-center\",children:\"The proposal owner will review your request and respond via email.\"})]});if(isFullPage){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\",children:/*#__PURE__*/_jsx(BuildingOfficeIcon,{className:\"h-8 w-8 text-blue-600\"})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Request Access\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Fill out the form below to request access to this proposal.\"})]}),formContent]})});}return formContent;};const PublicProposal=()=>{var _proposal$organizatio,_proposal$organizatio2,_proposal$status;const{id}=useParams();const[searchParams]=useSearchParams();const[proposal,setProposal]=useState(null);const[loading,setLoading]=useState(true);const[requiresPassword,setRequiresPassword]=useState(true);// Start with true to show access form by default\nconst[accessCode,setAccessCode]=useState('');const[isAuthenticated,setIsAuthenticated]=useState(false);const[submittingFeedback,setSubmittingFeedback]=useState(false);const[feedbackAction,setFeedbackAction]=useState(null);const[comment,setComment]=useState('');const[showRequestAccess,setShowRequestAccess]=useState(false);const[requestAccessData,setRequestAccessData]=useState({name:'',email:'',company:'',reason:''});const[submittingRequest,setSubmittingRequest]=useState(false);const fetchProposal=useCallback(async code=>{try{setLoading(true);const response=await publicAPI.getProposal(id,code);const data=response.data;if(!data.success){if(response.status===401){setRequiresPassword(true);setLoading(false);return;}if(response.status===403){if(data.requiresAccessRequest){// Access not granted for final state proposal\nsetProposal({id:id,title:'Access Required',content:'{}',clientName:'',author:{name:'',email:''},organization:{name:''},createdAt:new Date().toISOString(),status:'ACCESS_REQUIRED'});setIsAuthenticated(false);setLoading(false);return;}else{// Proposal has been approved/rejected (legacy case)\nsetProposal({id:id,title:'Proposal Reviewed',content:'{}',clientName:'',author:{name:'',email:''},organization:{name:''},createdAt:new Date().toISOString(),status:'REVIEWED'});setIsAuthenticated(true);setLoading(false);return;}}// For any other error, show the access code form\nsetRequiresPassword(true);setLoading(false);return;}setProposal(data.data);setRequiresPassword(false);// We successfully got the proposal, so no password required\nif(code){setIsAuthenticated(true);}}catch(error){var _error$response,_error$response2;console.error('Error fetching proposal:',error);if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){setRequiresPassword(true);setLoading(false);return;}if(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===403){var _error$response3,_error$response3$data;if((_error$response3=error.response)!==null&&_error$response3!==void 0&&(_error$response3$data=_error$response3.data)!==null&&_error$response3$data!==void 0&&_error$response3$data.requiresAccessRequest){// Access not granted for final state proposal\nsetProposal({id:id,title:'Access Required',content:'{}',clientName:'',author:{name:'',email:''},organization:{name:''},createdAt:new Date().toISOString(),status:'ACCESS_REQUIRED'});setIsAuthenticated(false);setLoading(false);return;}else{// Proposal has been approved/rejected (legacy case)\nsetProposal({id:id,title:'Proposal Reviewed',content:'{}',clientName:'',author:{name:'',email:''},organization:{name:''},createdAt:new Date().toISOString(),status:'REVIEWED'});setIsAuthenticated(true);setLoading(false);return;}}// For any other error, show the access code form\nsetRequiresPassword(true);setLoading(false);return;}finally{setLoading(false);}},[id]);useEffect(()=>{const code=searchParams.get('accessCode');if(code){setAccessCode(code);fetchProposal(code);}else{fetchProposal();}},[searchParams,fetchProposal]);const handleAccessCodeSubmit=async e=>{e.preventDefault();if(accessCode.length!==6){toast.error('Please enter a 6-character access code');return;}await fetchProposal(accessCode);};const handleFeedbackSubmit=async action=>{if(action==='comment'&&!comment.trim()){toast.error('Please enter a comment');return;}try{setSubmittingFeedback(true);const response=await publicAPI.submitFeedback(id,{accessCode,action,comment:action==='comment'?comment:undefined});const data=response.data;if(!data.success){throw new Error(data.error||'Failed to submit feedback');}toast.success(action==='approve'?'Proposal approved!':action==='reject'?'Proposal rejected.':'Comment submitted successfully!');// Update local state to reflect the change\nif(proposal){setProposal({...proposal,status:action==='approve'?'APPROVED':action==='reject'?'REJECTED':'IN_REVIEW'});}setFeedbackAction(null);setComment('');}catch(error){console.error('Error submitting feedback:',error);toast.error('Failed to submit feedback');}finally{setSubmittingFeedback(false);}};const parseContent=content=>{try{return JSON.parse(content);}catch{return{executiveSummary:content};}};const handleRequestAccess=async e=>{e.preventDefault();// For simplified form (final state proposals), use existing client info\nconst isSimplified=(proposal===null||proposal===void 0?void 0:proposal.status)==='APPROVED'||(proposal===null||proposal===void 0?void 0:proposal.status)==='REJECTED'||(proposal===null||proposal===void 0?void 0:proposal.status)==='EXPIRED'||(proposal===null||proposal===void 0?void 0:proposal.status)==='ACCESS_REQUIRED';if(!isSimplified&&(!requestAccessData.name.trim()||!requestAccessData.email.trim())){toast.error('Please fill in all required fields');return;}if(isSimplified&&!requestAccessData.reason.trim()){toast.error('Please provide a reason for requesting access');return;}try{setSubmittingRequest(true);// Use existing client info for simplified forms, otherwise use form data\nconst requestData=isSimplified?{name:(proposal===null||proposal===void 0?void 0:proposal.clientName)||'Unknown',email:(proposal===null||proposal===void 0?void 0:proposal.emailRecipient)||'Unknown',company:requestAccessData.company.trim(),reason:requestAccessData.reason.trim()}:{name:requestAccessData.name.trim(),email:requestAccessData.email.trim(),company:requestAccessData.company.trim(),reason:requestAccessData.reason.trim()};// Send request access email to the proposal author\nconst response=await fetch(`http://localhost:3001/api/public/proposals/${id}/request-access`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(requestData)});const data=await response.json();if(data.success){toast.success('Access request sent successfully! The proposal owner will review your request.');setShowRequestAccess(false);setRequestAccessData({name:'',email:'',company:'',reason:''});}else{throw new Error(data.error||'Failed to send access request');}}catch(error){console.error('Error requesting access:',error);toast.error('Failed to send access request. Please try again.');}finally{setSubmittingRequest(false);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Loading proposal...\"})]})});}// Debug logging\nconsole.log('PublicProposal render state:',{requiresPassword,isAuthenticated,loading,showRequestAccess,proposal:proposal?'exists':'null'});if(requiresPassword&&!isAuthenticated){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\",children:/*#__PURE__*/_jsx(LockClosedIcon,{className:\"h-8 w-8 text-blue-600\"})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Secure Proposal Access\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Enter the 6-character access code from your email to view this proposal.\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleAccessCodeSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"accessCode\",className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Access Code\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"accessCode\",value:accessCode,onChange:e=>setAccessCode(e.target.value.toUpperCase()),maxLength:6,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-lg font-mono tracking-widest\",placeholder:\"ABCD12\",autoComplete:\"off\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:accessCode.length!==6,className:\"w-full bg-gradient-to-r from-blue-600 to-blue-500 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-600 transition disabled:opacity-50 disabled:cursor-not-allowed\",children:\"Access Proposal\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mb-4\",children:\"Can't find your access code? Check your email or contact the sender.\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowRequestAccess(true),className:\"text-blue-600 hover:text-blue-700 text-sm font-medium underline\",children:\"Request Access to this Proposal\"})]})]})});}if(showRequestAccess){return/*#__PURE__*/_jsx(RequestAccessForm,{onSubmit:handleRequestAccess,requestAccessData:requestAccessData,setRequestAccessData:setRequestAccessData,submittingRequest:submittingRequest,onCancel:()=>setShowRequestAccess(false),isFullPage:true});}if(!proposal){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Proposal Not Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"The proposal you're looking for doesn't exist or has been removed.\"})]})});}const content=parseContent(proposal.content);// Check if proposal is in a final state (approved, rejected, expired, access required)\nconst isFinalState=proposal.status==='APPROVED'||proposal.status==='REJECTED'||proposal.status==='EXPIRED'||proposal.status==='ACCESS_REQUIRED';// Check if client has access to view content\n// For final state proposals, we need to check if they have been granted access\n// For active proposals, just having an access code is sufficient\nconst hasContentAccess=isAuthenticated;return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow-sm border-b border-gray-200\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[(_proposal$organizatio=proposal.organization)!==null&&_proposal$organizatio!==void 0&&_proposal$organizatio.logo?/*#__PURE__*/_jsx(\"img\",{src:proposal.organization.logo,alt:\"Logo\",className:\"h-10 w-auto\"}):/*#__PURE__*/_jsx(\"div\",{className:\"h-10 w-10 bg-blue-600 rounded-lg flex items-center justify-center\",children:/*#__PURE__*/_jsx(BuildingOfficeIcon,{className:\"h-6 w-6 text-white\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold text-gray-900\",children:((_proposal$organizatio2=proposal.organization)===null||_proposal$organizatio2===void 0?void 0:_proposal$organizatio2.name)||'ProposalAI'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Professional Proposal\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Sent on\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900\",children:new Date(proposal.emailSentAt||proposal.createdAt).toLocaleDateString()})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",children:[hasContentAccess||!isFinalState?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-lg p-8 mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-4\",children:proposal.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg text-gray-600\",children:[\"Prepared for \",proposal.clientName]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"h-5 w-5 text-blue-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Prepared by\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900\",children:proposal.author.name||proposal.author.email||'Unknown'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"h-5 w-5 text-blue-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Created on\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900\",children:new Date(proposal.createdAt).toLocaleDateString()})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"h-5 w-5 text-blue-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Status\"}),/*#__PURE__*/_jsx(\"p\",{className:`font-medium ${proposal.status==='APPROVED'?'text-green-600':proposal.status==='REJECTED'?'text-red-600':proposal.status==='IN_REVIEW'?'text-yellow-600':'text-gray-900'}`,children:proposal.status==='APPROVED'?'Approved':proposal.status==='REJECTED'?'Rejected':proposal.status==='IN_REVIEW'?'Under Review':'Ready for Review'})]})]})]})]}):null,hasContentAccess&&(content.executiveSummary||content.approach||content.budgetDetails||content.timeline||content.budget)&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-2xl shadow-lg p-8 mb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"prose max-w-none\",children:[content.executiveSummary&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Executive Summary\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-lg p-6\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 leading-relaxed whitespace-pre-wrap\",children:content.executiveSummary})})]}),content.approach&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Our Approach\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-lg p-6\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 leading-relaxed whitespace-pre-wrap\",children:content.approach})})]}),content.budgetDetails&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Budget Details\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-lg p-6\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 leading-relaxed whitespace-pre-wrap\",children:content.budgetDetails})})]}),content.timeline&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Timeline\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-lg p-6\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 leading-relaxed whitespace-pre-wrap\",children:content.timeline})})]}),content.budget&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Investment\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-50 rounded-lg p-6 border-l-4 border-blue-500\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-blue-900\",children:content.budget})})]})]})}),isFinalState&&!hasContentAccess&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-yellow-50 rounded-2xl shadow-lg p-8 mb-8 border border-yellow-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(LockClosedIcon,{className:\"h-16 w-16 text-yellow-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-yellow-900 mb-2\",children:\"Content Access Required\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-yellow-700 mb-6\",children:proposal.status==='ACCESS_REQUIRED'?'This proposal requires special access. To view the proposal content, you need to request access from the proposal owner.':`This proposal has been ${((_proposal$status=proposal.status)===null||_proposal$status===void 0?void 0:_proposal$status.toLowerCase())||'reviewed'}. To view the proposal content, you need to request access from the proposal owner.`}),/*#__PURE__*/_jsx(RequestAccessForm,{onSubmit:handleRequestAccess,requestAccessData:requestAccessData,setRequestAccessData:setRequestAccessData,submittingRequest:submittingRequest,simplified:true})]})}),proposal.status==='APPROVED'&&hasContentAccess?/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-50 rounded-2xl shadow-lg p-8 mb-8 border border-green-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(CheckCircleIcon,{className:\"h-16 w-16 text-green-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-green-900 mb-2\",children:\"Proposal Approved!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-green-700 mb-6\",children:\"Thank you for approving this proposal. The team will be in touch soon to discuss next steps.\"})]})}):proposal.status==='REJECTED'&&hasContentAccess?/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 rounded-2xl shadow-lg p-8 mb-8 border border-red-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(XCircleIcon,{className:\"h-16 w-16 text-red-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-red-900 mb-2\",children:\"Proposal Rejected\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-700 mb-6\",children:\"Thank you for your feedback. We appreciate you taking the time to review this proposal.\"})]})}):proposal.status==='EXPIRED'&&hasContentAccess?/*#__PURE__*/_jsx(\"div\",{className:\"bg-orange-50 rounded-2xl shadow-lg p-8 mb-8 border border-orange-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"h-16 w-16 text-orange-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-orange-900 mb-2\",children:\"Proposal Expired\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-orange-700 mb-6\",children:\"This proposal has expired. Please contact the proposal owner if you need to review it again.\"})]})}):!isFinalState?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-lg p-8 mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-6\",children:\"Provide Your Feedback\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setFeedbackAction('approve'),className:\"flex items-center justify-center space-x-2 p-4 border-2 border-green-200 rounded-lg hover:border-green-300 hover:bg-green-50 transition\",children:[/*#__PURE__*/_jsx(CheckCircleIcon,{className:\"h-6 w-6 text-green-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-green-700\",children:\"Approve\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setFeedbackAction('reject'),className:\"flex items-center justify-center space-x-2 p-4 border-2 border-red-200 rounded-lg hover:border-red-300 hover:bg-red-50 transition\",children:[/*#__PURE__*/_jsx(XCircleIcon,{className:\"h-6 w-6 text-red-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-red-700\",children:\"Reject\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setFeedbackAction('comment'),className:\"flex items-center justify-center space-x-2 p-4 border-2 border-blue-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition\",children:[/*#__PURE__*/_jsx(ChatBubbleLeftIcon,{className:\"h-6 w-6 text-blue-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-blue-700\",children:\"Comment\"})]})]}),feedbackAction==='comment'&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"comment\",className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Your Comments\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"comment\",value:comment,onChange:e=>setComment(e.target.value),rows:4,className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"Share your thoughts, questions, or requested modifications...\"})]}),feedbackAction&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleFeedbackSubmit(feedbackAction),disabled:submittingFeedback,className:\"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-600 transition disabled:opacity-50\",children:[submittingFeedback?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"}):/*#__PURE__*/_jsx(ArrowRightIcon,{className:\"h-5 w-5\"}),/*#__PURE__*/_jsx(\"span\",{children:feedbackAction==='approve'?'Approve Proposal':feedbackAction==='reject'?'Reject Proposal':'Submit Comment'})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setFeedbackAction(null);setComment('');},className:\"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition\",children:\"Cancel\"})]})]}):null,hasContentAccess&&!isFinalState&&/*#__PURE__*/_jsx(PublicComments,{proposalId:proposal.id,accessCode:accessCode,clientName:proposal.clientName,clientEmail:proposal.emailRecipient})]})]});};export default PublicProposal;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useParams","useSearchParams","CheckCircleIcon","XCircleIcon","ChatBubbleLeftIcon","LockClosedIcon","ArrowRightIcon","DocumentTextIcon","UserIcon","CalendarIcon","BuildingOfficeIcon","toast","publicAPI","PublicComments","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","RequestAccessForm","_ref","onSubmit","requestAccessData","setRequestAccessData","submittingRequest","onCancel","isFullPage","simplified","formContent","className","children","type","required","value","name","onChange","e","target","placeholder","email","company","reason","rows","disabled","onClick","PublicProposal","_proposal$organizatio","_proposal$organizatio2","_proposal$status","id","searchParams","proposal","setProposal","loading","setLoading","requiresPassword","setRequiresPassword","accessCode","setAccessCode","isAuthenticated","setIsAuthenticated","submittingFeedback","setSubmittingFeedback","feedbackAction","setFeedbackAction","comment","setComment","showRequestAccess","setShowRequestAccess","setSubmittingRequest","fetchProposal","code","response","getProposal","data","success","status","requiresAccessRequest","title","content","clientName","author","organization","createdAt","Date","toISOString","error","_error$response","_error$response2","console","_error$response3","_error$response3$data","get","handleAccessCodeSubmit","preventDefault","length","handleFeedbackSubmit","action","trim","submitFeedback","undefined","Error","parseContent","JSON","parse","executiveSummary","handleRequestAccess","isSimplified","requestData","emailRecipient","fetch","method","headers","body","stringify","json","log","htmlFor","toUpperCase","maxLength","autoComplete","isFinalState","hasContentAccess","logo","src","alt","emailSentAt","toLocaleDateString","approach","budgetDetails","timeline","budget","toLowerCase","proposalId","clientEmail"],"sources":["/Users/davnishsingh/Documents/proposalai-main/proposalai/client/src/pages/PublicProposal.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useParams, useSearchParams } from 'react-router-dom';\nimport { \n  CheckCircleIcon, \n  XCircleIcon, \n  ChatBubbleLeftIcon,\n  LockClosedIcon,\n  ArrowRightIcon,\n  DocumentTextIcon,\n  UserIcon,\n  CalendarIcon,\n  BuildingOfficeIcon\n} from '@heroicons/react/24/outline';\nimport toast from 'react-hot-toast';\nimport { publicAPI } from '../services/api';\nimport PublicComments from '../components/PublicComments';\n\ninterface Proposal {\n  id: string;\n  title: string;\n  content: string;\n  clientName: string;\n  author: {\n    name: string;\n    email: string;\n  };\n  organization: {\n    name: string;\n    logo?: string;\n    website?: string;\n  };\n  createdAt: string;\n  emailSentAt?: string;\n  emailRecipient?: string;\n  status?: string;\n}\n\n// Reusable Request Access Form Component\nconst RequestAccessForm: React.FC<{\n  onSubmit: (e: React.FormEvent) => Promise<void>;\n  requestAccessData: {\n    name: string;\n    email: string;\n    company: string;\n    reason: string;\n  };\n  setRequestAccessData: React.Dispatch<React.SetStateAction<{\n    name: string;\n    email: string;\n    company: string;\n    reason: string;\n  }>>;\n  submittingRequest: boolean;\n  onCancel?: () => void;\n  isFullPage?: boolean;\n  simplified?: boolean;\n}> = ({ onSubmit, requestAccessData, setRequestAccessData, submittingRequest, onCancel, isFullPage = false, simplified = false }) => {\n  const formContent = (\n    <div className={`bg-white rounded-lg p-6 ${isFullPage ? 'max-w-md w-full' : 'max-w-md mx-auto'}`}>\n      <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Request Access</h3>\n      <p className=\"text-sm text-gray-600 mb-4\">\n        {simplified \n          ? \"Need to review this proposal again? Let us know why you need access.\"\n          : \"Need to review this proposal again? Request access from the proposal owner.\"\n        }\n      </p>\n      \n      <form onSubmit={onSubmit} className=\"space-y-4\">\n        {!simplified && (\n          <>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Your Name *\n              </label>\n              <input\n                type=\"text\"\n                required={!simplified}\n                value={requestAccessData.name}\n                onChange={(e) => setRequestAccessData({...requestAccessData, name: e.target.value})}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"Enter your full name\"\n              />\n            </div>\n            \n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Email Address *\n              </label>\n              <input\n                type=\"email\"\n                required={!simplified}\n                value={requestAccessData.email}\n                onChange={(e) => setRequestAccessData({...requestAccessData, email: e.target.value})}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"Enter your email address\"\n              />\n            </div>\n            \n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Company\n              </label>\n              <input\n                type=\"text\"\n                value={requestAccessData.company}\n                onChange={(e) => setRequestAccessData({...requestAccessData, company: e.target.value})}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"Enter your company name\"\n              />\n            </div>\n          </>\n        )}\n        \n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Reason for Access {simplified && '*'}\n          </label>\n          <textarea\n            required={simplified}\n            value={requestAccessData.reason}\n            onChange={(e) => setRequestAccessData({...requestAccessData, reason: e.target.value})}\n            rows={3}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            placeholder=\"Why do you need access to this proposal?\"\n          />\n        </div>\n        \n        <div className=\"flex space-x-4\">\n          <button\n            type=\"submit\"\n            disabled={submittingRequest}\n            className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {submittingRequest ? (\n              <span className=\"flex items-center justify-center\">\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                Sending Request...\n              </span>\n            ) : (\n              'Request Access'\n            )}\n          </button>\n          \n          {onCancel && (\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition\"\n            >\n              Cancel\n            </button>\n          )}\n        </div>\n      </form>\n      \n      <p className=\"text-xs text-gray-500 mt-4 text-center\">\n        The proposal owner will review your request and respond via email.\n      </p>\n    </div>\n  );\n\n  if (isFullPage) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8\">\n          <div className=\"text-center mb-8\">\n            <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\">\n              <BuildingOfficeIcon className=\"h-8 w-8 text-blue-600\" />\n            </div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Request Access</h1>\n            <p className=\"text-gray-600\">Fill out the form below to request access to this proposal.</p>\n          </div>\n          {formContent}\n        </div>\n      </div>\n    );\n  }\n\n  return formContent;\n};\n\nconst PublicProposal: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const [searchParams] = useSearchParams();\n  const [proposal, setProposal] = useState<Proposal | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [requiresPassword, setRequiresPassword] = useState(true); // Start with true to show access form by default\n  const [accessCode, setAccessCode] = useState('');\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [submittingFeedback, setSubmittingFeedback] = useState(false);\n  const [feedbackAction, setFeedbackAction] = useState<'approve' | 'reject' | 'comment' | null>(null);\n  const [comment, setComment] = useState('');\n  const [showRequestAccess, setShowRequestAccess] = useState(false);\n  const [requestAccessData, setRequestAccessData] = useState({\n    name: '',\n    email: '',\n    company: '',\n    reason: ''\n  });\n  const [submittingRequest, setSubmittingRequest] = useState(false);\n\n  const fetchProposal = useCallback(async (code?: string) => {\n    try {\n      setLoading(true);\n      const response = await publicAPI.getProposal(id!, code);\n      const data = response.data;\n\n      if (!data.success) {\n        if (response.status === 401) {\n          setRequiresPassword(true);\n          setLoading(false);\n          return;\n        }\n        if (response.status === 403) {\n          if (data.requiresAccessRequest) {\n            // Access not granted for final state proposal\n            setProposal({ \n              id: id!, \n              title: 'Access Required', \n              content: '{}', \n              clientName: '', \n              author: { name: '', email: '' }, \n              organization: { name: '' },\n              createdAt: new Date().toISOString(),\n              status: 'ACCESS_REQUIRED'\n            });\n            setIsAuthenticated(false);\n            setLoading(false);\n            return;\n          } else {\n            // Proposal has been approved/rejected (legacy case)\n            setProposal({ \n              id: id!, \n              title: 'Proposal Reviewed', \n              content: '{}', \n              clientName: '', \n              author: { name: '', email: '' }, \n              organization: { name: '' },\n              createdAt: new Date().toISOString(),\n              status: 'REVIEWED'\n            });\n            setIsAuthenticated(true);\n            setLoading(false);\n            return;\n          }\n        }\n        // For any other error, show the access code form\n        setRequiresPassword(true);\n        setLoading(false);\n        return;\n      }\n\n      setProposal(data.data);\n      setRequiresPassword(false); // We successfully got the proposal, so no password required\n      if (code) {\n        setIsAuthenticated(true);\n      }\n    } catch (error: any) {\n      console.error('Error fetching proposal:', error);\n      if (error.response?.status === 401) {\n        setRequiresPassword(true);\n        setLoading(false);\n        return;\n      }\n              if (error.response?.status === 403) {\n          if (error.response?.data?.requiresAccessRequest) {\n            // Access not granted for final state proposal\n            setProposal({ \n              id: id!, \n              title: 'Access Required', \n              content: '{}', \n              clientName: '', \n              author: { name: '', email: '' }, \n              organization: { name: '' },\n              createdAt: new Date().toISOString(),\n              status: 'ACCESS_REQUIRED'\n            });\n            setIsAuthenticated(false);\n            setLoading(false);\n            return;\n        } else {\n          // Proposal has been approved/rejected (legacy case)\n          setProposal({ \n            id: id!, \n            title: 'Proposal Reviewed', \n            content: '{}', \n            clientName: '', \n            author: { name: '', email: '' }, \n            organization: { name: '' },\n            createdAt: new Date().toISOString(),\n            status: 'REVIEWED'\n          });\n          setIsAuthenticated(true);\n          setLoading(false);\n          return;\n        }\n      }\n      // For any other error, show the access code form\n      setRequiresPassword(true);\n      setLoading(false);\n      return;\n    } finally {\n      setLoading(false);\n    }\n  }, [id]);\n\n  useEffect(() => {\n    const code = searchParams.get('accessCode');\n    if (code) {\n      setAccessCode(code);\n      fetchProposal(code);\n    } else {\n      fetchProposal();\n    }\n  }, [searchParams, fetchProposal]);\n\n  const handleAccessCodeSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (accessCode.length !== 6) {\n      toast.error('Please enter a 6-character access code');\n      return;\n    }\n    await fetchProposal(accessCode);\n  };\n\n  const handleFeedbackSubmit = async (action: 'approve' | 'reject' | 'comment') => {\n    if (action === 'comment' && !comment.trim()) {\n      toast.error('Please enter a comment');\n      return;\n    }\n\n    try {\n      setSubmittingFeedback(true);\n      const response = await publicAPI.submitFeedback(id!, {\n        accessCode,\n        action,\n        comment: action === 'comment' ? comment : undefined\n      });\n\n      const data = response.data;\n\n      if (!data.success) {\n        throw new Error(data.error || 'Failed to submit feedback');\n      }\n\n      toast.success(\n        action === 'approve' ? 'Proposal approved!' :\n        action === 'reject' ? 'Proposal rejected.' :\n        'Comment submitted successfully!'\n      );\n\n      // Update local state to reflect the change\n      if (proposal) {\n        setProposal({\n          ...proposal,\n          status: action === 'approve' ? 'APPROVED' : action === 'reject' ? 'REJECTED' : 'IN_REVIEW'\n        });\n      }\n\n      setFeedbackAction(null);\n      setComment('');\n    } catch (error) {\n      console.error('Error submitting feedback:', error);\n      toast.error('Failed to submit feedback');\n    } finally {\n      setSubmittingFeedback(false);\n    }\n  };\n\n  const parseContent = (content: string) => {\n    try {\n      return JSON.parse(content);\n    } catch {\n      return { executiveSummary: content };\n    }\n  };\n\n  const handleRequestAccess = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // For simplified form (final state proposals), use existing client info\n    const isSimplified = proposal?.status === 'APPROVED' || proposal?.status === 'REJECTED' || proposal?.status === 'EXPIRED' || proposal?.status === 'ACCESS_REQUIRED';\n    \n\n    \n    if (!isSimplified && (!requestAccessData.name.trim() || !requestAccessData.email.trim())) {\n      toast.error('Please fill in all required fields');\n      return;\n    }\n    \n    if (isSimplified && !requestAccessData.reason.trim()) {\n      toast.error('Please provide a reason for requesting access');\n      return;\n    }\n\n    try {\n      setSubmittingRequest(true);\n      \n      // Use existing client info for simplified forms, otherwise use form data\n      const requestData = isSimplified ? {\n        name: proposal?.clientName || 'Unknown',\n        email: proposal?.emailRecipient || 'Unknown',\n        company: requestAccessData.company.trim(),\n        reason: requestAccessData.reason.trim()\n      } : {\n        name: requestAccessData.name.trim(),\n        email: requestAccessData.email.trim(),\n        company: requestAccessData.company.trim(),\n        reason: requestAccessData.reason.trim()\n      };\n      \n      // Send request access email to the proposal author\n      const response = await fetch(`http://localhost:3001/api/public/proposals/${id}/request-access`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestData)\n      });\n\n      const data = await response.json();\n\n      if (data.success) {\n        toast.success('Access request sent successfully! The proposal owner will review your request.');\n        setShowRequestAccess(false);\n        setRequestAccessData({ name: '', email: '', company: '', reason: '' });\n      } else {\n        throw new Error(data.error || 'Failed to send access request');\n      }\n    } catch (error) {\n      console.error('Error requesting access:', error);\n      toast.error('Failed to send access request. Please try again.');\n    } finally {\n      setSubmittingRequest(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading proposal...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Debug logging\n  console.log('PublicProposal render state:', { \n    requiresPassword, \n    isAuthenticated, \n    loading, \n    showRequestAccess,\n    proposal: proposal ? 'exists' : 'null'\n  });\n\n  if (requiresPassword && !isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8\">\n          <div className=\"text-center mb-8\">\n            <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\">\n              <LockClosedIcon className=\"h-8 w-8 text-blue-600\" />\n            </div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Secure Proposal Access</h1>\n            <p className=\"text-gray-600\">Enter the 6-character access code from your email to view this proposal.</p>\n          </div>\n\n          <form onSubmit={handleAccessCodeSubmit} className=\"space-y-6\">\n            <div>\n              <label htmlFor=\"accessCode\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Access Code\n              </label>\n              <input\n                type=\"text\"\n                id=\"accessCode\"\n                value={accessCode}\n                onChange={(e) => setAccessCode(e.target.value.toUpperCase())}\n                maxLength={6}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-lg font-mono tracking-widest\"\n                placeholder=\"ABCD12\"\n                autoComplete=\"off\"\n              />\n            </div>\n            <button\n              type=\"submit\"\n              disabled={accessCode.length !== 6}\n              className=\"w-full bg-gradient-to-r from-blue-600 to-blue-500 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-600 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Access Proposal\n            </button>\n          </form>\n\n          <div className=\"mt-6 text-center\">\n            <p className=\"text-sm text-gray-500 mb-4\">\n              Can't find your access code? Check your email or contact the sender.\n            </p>\n            <button\n              type=\"button\"\n              onClick={() => setShowRequestAccess(true)}\n              className=\"text-blue-600 hover:text-blue-700 text-sm font-medium underline\"\n            >\n              Request Access to this Proposal\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (showRequestAccess) {\n    return (\n      <RequestAccessForm\n        onSubmit={handleRequestAccess}\n        requestAccessData={requestAccessData}\n        setRequestAccessData={setRequestAccessData}\n        submittingRequest={submittingRequest}\n        onCancel={() => setShowRequestAccess(false)}\n        isFullPage={true}\n      />\n    );\n  }\n\n  if (!proposal) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Proposal Not Found</h1>\n          <p className=\"text-gray-600\">The proposal you're looking for doesn't exist or has been removed.</p>\n        </div>\n      </div>\n    );\n  }\n\n  const content = parseContent(proposal.content);\n  \n  // Check if proposal is in a final state (approved, rejected, expired, access required)\n  const isFinalState = proposal.status === 'APPROVED' || proposal.status === 'REJECTED' || proposal.status === 'EXPIRED' || proposal.status === 'ACCESS_REQUIRED';\n  \n  // Check if client has access to view content\n  // For final state proposals, we need to check if they have been granted access\n  // For active proposals, just having an access code is sufficient\n  const hasContentAccess = isAuthenticated;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-4\">\n              {proposal.organization?.logo ? (\n                <img src={proposal.organization.logo} alt=\"Logo\" className=\"h-10 w-auto\" />\n              ) : (\n                <div className=\"h-10 w-10 bg-blue-600 rounded-lg flex items-center justify-center\">\n                  <BuildingOfficeIcon className=\"h-6 w-6 text-white\" />\n                </div>\n              )}\n              <div>\n                <h1 className=\"text-xl font-bold text-gray-900\">{proposal.organization?.name || 'ProposalAI'}</h1>\n                <p className=\"text-sm text-gray-500\">Professional Proposal</p>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <p className=\"text-sm text-gray-500\">Sent on</p>\n              <p className=\"text-sm font-medium text-gray-900\">\n                {new Date(proposal.emailSentAt || proposal.createdAt).toLocaleDateString()}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Proposal Header - Only show if client has access or proposal is not in final state */}\n        {hasContentAccess || !isFinalState ? (\n          <div className=\"bg-white rounded-2xl shadow-lg p-8 mb-8\">\n            <div className=\"text-center mb-8\">\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">{proposal.title}</h1>\n              <p className=\"text-lg text-gray-600\">Prepared for {proposal.clientName}</p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n              <div className=\"flex items-center space-x-3\">\n                <UserIcon className=\"h-5 w-5 text-blue-600\" />\n                <div>\n                  <p className=\"text-sm text-gray-500\">Prepared by</p>\n                  <p className=\"font-medium text-gray-900\">\n                    {proposal.author.name || proposal.author.email || 'Unknown'}\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-3\">\n                <CalendarIcon className=\"h-5 w-5 text-blue-600\" />\n                <div>\n                  <p className=\"text-sm text-gray-500\">Created on</p>\n                  <p className=\"font-medium text-gray-900\">\n                    {new Date(proposal.createdAt).toLocaleDateString()}\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-3\">\n                <DocumentTextIcon className=\"h-5 w-5 text-blue-600\" />\n                <div>\n                  <p className=\"text-sm text-gray-500\">Status</p>\n                  <p className={`font-medium ${\n                    proposal.status === 'APPROVED' ? 'text-green-600' :\n                    proposal.status === 'REJECTED' ? 'text-red-600' :\n                    proposal.status === 'IN_REVIEW' ? 'text-yellow-600' :\n                    'text-gray-900'\n                  }`}>\n                    {proposal.status === 'APPROVED' ? 'Approved' :\n                     proposal.status === 'REJECTED' ? 'Rejected' :\n                     proposal.status === 'IN_REVIEW' ? 'Under Review' :\n                     'Ready for Review'}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        ) : null}\n\n        {/* Proposal Content - Only show if client has access and there's actual content */}\n        {hasContentAccess && (content.executiveSummary || content.approach || content.budgetDetails || content.timeline || content.budget) && (\n          <div className=\"bg-white rounded-2xl shadow-lg p-8 mb-8\">\n            <div className=\"prose max-w-none\">\n              {content.executiveSummary && (\n                <div className=\"mb-8\">\n                  <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Executive Summary</h2>\n                  <div className=\"bg-gray-50 rounded-lg p-6\">\n                    <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">{content.executiveSummary}</p>\n                  </div>\n                </div>\n              )}\n\n              {content.approach && (\n                <div className=\"mb-8\">\n                  <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Our Approach</h2>\n                  <div className=\"bg-gray-50 rounded-lg p-6\">\n                    <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">{content.approach}</p>\n                  </div>\n                </div>\n              )}\n\n              {content.budgetDetails && (\n                <div className=\"mb-8\">\n                  <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Budget Details</h2>\n                  <div className=\"bg-gray-50 rounded-lg p-6\">\n                    <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">{content.budgetDetails}</p>\n                  </div>\n                </div>\n              )}\n\n              {content.timeline && (\n                <div className=\"mb-8\">\n                  <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Timeline</h2>\n                  <div className=\"bg-gray-50 rounded-lg p-6\">\n                    <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">{content.timeline}</p>\n                  </div>\n                </div>\n              )}\n\n              {content.budget && (\n                <div className=\"mb-8\">\n                  <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Investment</h2>\n                  <div className=\"bg-blue-50 rounded-lg p-6 border-l-4 border-blue-500\">\n                    <p className=\"text-2xl font-bold text-blue-900\">{content.budget}</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Content Access Required Message for Final State Proposals */}\n        {isFinalState && !hasContentAccess && (\n          <div className=\"bg-yellow-50 rounded-2xl shadow-lg p-8 mb-8 border border-yellow-200\">\n            <div className=\"text-center\">\n              <LockClosedIcon className=\"h-16 w-16 text-yellow-600 mx-auto mb-4\" />\n              <h2 className=\"text-2xl font-bold text-yellow-900 mb-2\">Content Access Required</h2>\n              <p className=\"text-yellow-700 mb-6\">\n                {proposal.status === 'ACCESS_REQUIRED' \n                  ? 'This proposal requires special access. To view the proposal content, you need to request access from the proposal owner.'\n                  : `This proposal has been ${proposal.status?.toLowerCase() || 'reviewed'}. To view the proposal content, you need to request access from the proposal owner.`\n                }\n              </p>\n              \n              {/* Request Access Form for Final State Proposals */}\n              <RequestAccessForm\n                onSubmit={handleRequestAccess}\n                requestAccessData={requestAccessData}\n                setRequestAccessData={setRequestAccessData}\n                submittingRequest={submittingRequest}\n                simplified={true}\n              />\n            </div>\n          </div>\n        )}\n\n        {/* Feedback Section - Only show if client has access */}\n        {proposal.status === 'APPROVED' && hasContentAccess ? (\n          <div className=\"bg-green-50 rounded-2xl shadow-lg p-8 mb-8 border border-green-200\">\n            <div className=\"text-center\">\n              <CheckCircleIcon className=\"h-16 w-16 text-green-600 mx-auto mb-4\" />\n              <h2 className=\"text-2xl font-bold text-green-900 mb-2\">Proposal Approved!</h2>\n              <p className=\"text-green-700 mb-6\">Thank you for approving this proposal. The team will be in touch soon to discuss next steps.</p>\n            </div>\n          </div>\n        ) : proposal.status === 'REJECTED' && hasContentAccess ? (\n          <div className=\"bg-red-50 rounded-2xl shadow-lg p-8 mb-8 border border-red-200\">\n            <div className=\"text-center\">\n              <XCircleIcon className=\"h-16 w-16 text-red-600 mx-auto mb-4\" />\n              <h2 className=\"text-2xl font-bold text-red-900 mb-2\">Proposal Rejected</h2>\n              <p className=\"text-red-700 mb-6\">Thank you for your feedback. We appreciate you taking the time to review this proposal.</p>\n            </div>\n          </div>\n        ) : proposal.status === 'EXPIRED' && hasContentAccess ? (\n          <div className=\"bg-orange-50 rounded-2xl shadow-lg p-8 mb-8 border border-orange-200\">\n            <div className=\"text-center\">\n              <CalendarIcon className=\"h-16 w-16 text-orange-600 mx-auto mb-4\" />\n              <h2 className=\"text-2xl font-bold text-orange-900 mb-2\">Proposal Expired</h2>\n              <p className=\"text-orange-700 mb-6\">This proposal has expired. Please contact the proposal owner if you need to review it again.</p>\n            </div>\n          </div>\n        ) : !isFinalState ? (\n          <div className=\"bg-white rounded-2xl shadow-lg p-8 mb-8\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Provide Your Feedback</h2>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n              <button\n                onClick={() => setFeedbackAction('approve')}\n                className=\"flex items-center justify-center space-x-2 p-4 border-2 border-green-200 rounded-lg hover:border-green-300 hover:bg-green-50 transition\"\n              >\n                <CheckCircleIcon className=\"h-6 w-6 text-green-600\" />\n                <span className=\"font-medium text-green-700\">Approve</span>\n              </button>\n              \n              <button\n                onClick={() => setFeedbackAction('reject')}\n                className=\"flex items-center justify-center space-x-2 p-4 border-2 border-red-200 rounded-lg hover:border-red-300 hover:bg-red-50 transition\"\n              >\n                <XCircleIcon className=\"h-6 w-6 text-red-600\" />\n                <span className=\"font-medium text-red-700\">Reject</span>\n              </button>\n              \n              <button\n                onClick={() => setFeedbackAction('comment')}\n                className=\"flex items-center justify-center space-x-2 p-4 border-2 border-blue-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition\"\n              >\n                <ChatBubbleLeftIcon className=\"h-6 w-6 text-blue-600\" />\n                <span className=\"font-medium text-blue-700\">Comment</span>\n              </button>\n            </div>\n\n            {feedbackAction === 'comment' && (\n              <div className=\"mb-6\">\n                <label htmlFor=\"comment\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Your Comments\n                </label>\n                <textarea\n                  id=\"comment\"\n                  value={comment}\n                  onChange={(e) => setComment(e.target.value)}\n                  rows={4}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"Share your thoughts, questions, or requested modifications...\"\n                />\n              </div>\n            )}\n\n            {feedbackAction && (\n              <div className=\"flex space-x-4\">\n                <button\n                  onClick={() => handleFeedbackSubmit(feedbackAction)}\n                  disabled={submittingFeedback}\n                  className=\"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-600 transition disabled:opacity-50\"\n                >\n                  {submittingFeedback ? (\n                    <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\n                  ) : (\n                    <ArrowRightIcon className=\"h-5 w-5\" />\n                  )}\n                  <span>\n                    {feedbackAction === 'approve' ? 'Approve Proposal' :\n                     feedbackAction === 'reject' ? 'Reject Proposal' :\n                     'Submit Comment'}\n                  </span>\n                </button>\n                \n                <button\n                  onClick={() => {\n                    setFeedbackAction(null);\n                    setComment('');\n                  }}\n                  className=\"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition\"\n                >\n                  Cancel\n                </button>\n              </div>\n            )}\n          </div>\n        ) : null}\n\n        {/* Comments Section - Only show if client has access and proposal is not in final state */}\n        {hasContentAccess && !isFinalState && (\n          <PublicComments \n            proposalId={proposal.id} \n            accessCode={accessCode}\n            clientName={proposal.clientName}\n            clientEmail={proposal.emailRecipient}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default PublicProposal; "],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CAC/D,OAASC,SAAS,CAAEC,eAAe,KAAQ,kBAAkB,CAC7D,OACEC,eAAe,CACfC,WAAW,CACXC,kBAAkB,CAClBC,cAAc,CACdC,cAAc,CACdC,gBAAgB,CAChBC,QAAQ,CACRC,YAAY,CACZC,kBAAkB,KACb,6BAA6B,CACpC,MAAO,CAAAC,KAAK,KAAM,iBAAiB,CACnC,OAASC,SAAS,KAAQ,iBAAiB,CAC3C,MAAO,CAAAC,cAAc,KAAM,8BAA8B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAsB1D;AACA,KAAM,CAAAC,iBAkBJ,CAAGC,IAAA,EAAgI,IAA/H,CAAEC,QAAQ,CAAEC,iBAAiB,CAAEC,oBAAoB,CAAEC,iBAAiB,CAAEC,QAAQ,CAAEC,UAAU,CAAG,KAAK,CAAEC,UAAU,CAAG,KAAM,CAAC,CAAAP,IAAA,CAC9H,KAAM,CAAAQ,WAAW,cACfZ,KAAA,QAAKa,SAAS,CAAE,2BAA2BH,UAAU,CAAG,iBAAiB,CAAG,kBAAkB,EAAG,CAAAI,QAAA,eAC/FhB,IAAA,OAAIe,SAAS,CAAC,0CAA0C,CAAAC,QAAA,CAAC,gBAAc,CAAI,CAAC,cAC5EhB,IAAA,MAAGe,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CACtCH,UAAU,CACP,sEAAsE,CACtE,6EAA6E,CAEhF,CAAC,cAEJX,KAAA,SAAMK,QAAQ,CAAEA,QAAS,CAACQ,SAAS,CAAC,WAAW,CAAAC,QAAA,EAC5C,CAACH,UAAU,eACVX,KAAA,CAAAE,SAAA,EAAAY,QAAA,eACEd,KAAA,QAAAc,QAAA,eACEhB,IAAA,UAAOe,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CAAC,aAEhE,CAAO,CAAC,cACRhB,IAAA,UACEiB,IAAI,CAAC,MAAM,CACXC,QAAQ,CAAE,CAACL,UAAW,CACtBM,KAAK,CAAEX,iBAAiB,CAACY,IAAK,CAC9BC,QAAQ,CAAGC,CAAC,EAAKb,oBAAoB,CAAC,CAAC,GAAGD,iBAAiB,CAAEY,IAAI,CAAEE,CAAC,CAACC,MAAM,CAACJ,KAAK,CAAC,CAAE,CACpFJ,SAAS,CAAC,iIAAiI,CAC3IS,WAAW,CAAC,sBAAsB,CACnC,CAAC,EACC,CAAC,cAENtB,KAAA,QAAAc,QAAA,eACEhB,IAAA,UAAOe,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CAAC,iBAEhE,CAAO,CAAC,cACRhB,IAAA,UACEiB,IAAI,CAAC,OAAO,CACZC,QAAQ,CAAE,CAACL,UAAW,CACtBM,KAAK,CAAEX,iBAAiB,CAACiB,KAAM,CAC/BJ,QAAQ,CAAGC,CAAC,EAAKb,oBAAoB,CAAC,CAAC,GAAGD,iBAAiB,CAAEiB,KAAK,CAAEH,CAAC,CAACC,MAAM,CAACJ,KAAK,CAAC,CAAE,CACrFJ,SAAS,CAAC,iIAAiI,CAC3IS,WAAW,CAAC,0BAA0B,CACvC,CAAC,EACC,CAAC,cAENtB,KAAA,QAAAc,QAAA,eACEhB,IAAA,UAAOe,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CAAC,SAEhE,CAAO,CAAC,cACRhB,IAAA,UACEiB,IAAI,CAAC,MAAM,CACXE,KAAK,CAAEX,iBAAiB,CAACkB,OAAQ,CACjCL,QAAQ,CAAGC,CAAC,EAAKb,oBAAoB,CAAC,CAAC,GAAGD,iBAAiB,CAAEkB,OAAO,CAAEJ,CAAC,CAACC,MAAM,CAACJ,KAAK,CAAC,CAAE,CACvFJ,SAAS,CAAC,iIAAiI,CAC3IS,WAAW,CAAC,yBAAyB,CACtC,CAAC,EACC,CAAC,EACN,CACH,cAEDtB,KAAA,QAAAc,QAAA,eACEd,KAAA,UAAOa,SAAS,CAAC,8CAA8C,CAAAC,QAAA,EAAC,oBAC5C,CAACH,UAAU,EAAI,GAAG,EAC/B,CAAC,cACRb,IAAA,aACEkB,QAAQ,CAAEL,UAAW,CACrBM,KAAK,CAAEX,iBAAiB,CAACmB,MAAO,CAChCN,QAAQ,CAAGC,CAAC,EAAKb,oBAAoB,CAAC,CAAC,GAAGD,iBAAiB,CAAEmB,MAAM,CAAEL,CAAC,CAACC,MAAM,CAACJ,KAAK,CAAC,CAAE,CACtFS,IAAI,CAAE,CAAE,CACRb,SAAS,CAAC,iIAAiI,CAC3IS,WAAW,CAAC,0CAA0C,CACvD,CAAC,EACC,CAAC,cAENtB,KAAA,QAAKa,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BhB,IAAA,WACEiB,IAAI,CAAC,QAAQ,CACbY,QAAQ,CAAEnB,iBAAkB,CAC5BK,SAAS,CAAC,+IAA+I,CAAAC,QAAA,CAExJN,iBAAiB,cAChBR,KAAA,SAAMa,SAAS,CAAC,kCAAkC,CAAAC,QAAA,eAChDhB,IAAA,QAAKe,SAAS,CAAC,gEAAgE,CAAM,CAAC,qBAExF,EAAM,CAAC,CAEP,gBACD,CACK,CAAC,CAERJ,QAAQ,eACPX,IAAA,WACEiB,IAAI,CAAC,QAAQ,CACba,OAAO,CAAEnB,QAAS,CAClBI,SAAS,CAAC,qGAAqG,CAAAC,QAAA,CAChH,QAED,CAAQ,CACT,EACE,CAAC,EACF,CAAC,cAEPhB,IAAA,MAAGe,SAAS,CAAC,wCAAwC,CAAAC,QAAA,CAAC,oEAEtD,CAAG,CAAC,EACD,CACN,CAED,GAAIJ,UAAU,CAAE,CACd,mBACEZ,IAAA,QAAKe,SAAS,CAAC,yGAAyG,CAAAC,QAAA,cACtHd,KAAA,QAAKa,SAAS,CAAC,oDAAoD,CAAAC,QAAA,eACjEd,KAAA,QAAKa,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/BhB,IAAA,QAAKe,SAAS,CAAC,kFAAkF,CAAAC,QAAA,cAC/FhB,IAAA,CAACL,kBAAkB,EAACoB,SAAS,CAAC,uBAAuB,CAAE,CAAC,CACrD,CAAC,cACNf,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,gBAAc,CAAI,CAAC,cACzEhB,IAAA,MAAGe,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAC,6DAA2D,CAAG,CAAC,EACzF,CAAC,CACLF,WAAW,EACT,CAAC,CACH,CAAC,CAEV,CAEA,MAAO,CAAAA,WAAW,CACpB,CAAC,CAED,KAAM,CAAAiB,cAAwB,CAAGA,CAAA,GAAM,KAAAC,qBAAA,CAAAC,sBAAA,CAAAC,gBAAA,CACrC,KAAM,CAAEC,EAAG,CAAC,CAAGlD,SAAS,CAAiB,CAAC,CAC1C,KAAM,CAACmD,YAAY,CAAC,CAAGlD,eAAe,CAAC,CAAC,CACxC,KAAM,CAACmD,QAAQ,CAAEC,WAAW,CAAC,CAAGxD,QAAQ,CAAkB,IAAI,CAAC,CAC/D,KAAM,CAACyD,OAAO,CAAEC,UAAU,CAAC,CAAG1D,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAC2D,gBAAgB,CAAEC,mBAAmB,CAAC,CAAG5D,QAAQ,CAAC,IAAI,CAAC,CAAE;AAChE,KAAM,CAAC6D,UAAU,CAAEC,aAAa,CAAC,CAAG9D,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC+D,eAAe,CAAEC,kBAAkB,CAAC,CAAGhE,QAAQ,CAAC,KAAK,CAAC,CAC7D,KAAM,CAACiE,kBAAkB,CAAEC,qBAAqB,CAAC,CAAGlE,QAAQ,CAAC,KAAK,CAAC,CACnE,KAAM,CAACmE,cAAc,CAAEC,iBAAiB,CAAC,CAAGpE,QAAQ,CAA0C,IAAI,CAAC,CACnG,KAAM,CAACqE,OAAO,CAAEC,UAAU,CAAC,CAAGtE,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACuE,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGxE,QAAQ,CAAC,KAAK,CAAC,CACjE,KAAM,CAAC0B,iBAAiB,CAAEC,oBAAoB,CAAC,CAAG3B,QAAQ,CAAC,CACzDsC,IAAI,CAAE,EAAE,CACRK,KAAK,CAAE,EAAE,CACTC,OAAO,CAAE,EAAE,CACXC,MAAM,CAAE,EACV,CAAC,CAAC,CACF,KAAM,CAACjB,iBAAiB,CAAE6C,oBAAoB,CAAC,CAAGzE,QAAQ,CAAC,KAAK,CAAC,CAEjE,KAAM,CAAA0E,aAAa,CAAGxE,WAAW,CAAC,KAAO,CAAAyE,IAAa,EAAK,CACzD,GAAI,CACFjB,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAkB,QAAQ,CAAG,KAAM,CAAA7D,SAAS,CAAC8D,WAAW,CAACxB,EAAE,CAAGsB,IAAI,CAAC,CACvD,KAAM,CAAAG,IAAI,CAAGF,QAAQ,CAACE,IAAI,CAE1B,GAAI,CAACA,IAAI,CAACC,OAAO,CAAE,CACjB,GAAIH,QAAQ,CAACI,MAAM,GAAK,GAAG,CAAE,CAC3BpB,mBAAmB,CAAC,IAAI,CAAC,CACzBF,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CACA,GAAIkB,QAAQ,CAACI,MAAM,GAAK,GAAG,CAAE,CAC3B,GAAIF,IAAI,CAACG,qBAAqB,CAAE,CAC9B;AACAzB,WAAW,CAAC,CACVH,EAAE,CAAEA,EAAG,CACP6B,KAAK,CAAE,iBAAiB,CACxBC,OAAO,CAAE,IAAI,CACbC,UAAU,CAAE,EAAE,CACdC,MAAM,CAAE,CAAE/C,IAAI,CAAE,EAAE,CAAEK,KAAK,CAAE,EAAG,CAAC,CAC/B2C,YAAY,CAAE,CAAEhD,IAAI,CAAE,EAAG,CAAC,CAC1BiD,SAAS,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CACnCT,MAAM,CAAE,iBACV,CAAC,CAAC,CACFhB,kBAAkB,CAAC,KAAK,CAAC,CACzBN,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CAAC,IAAM,CACL;AACAF,WAAW,CAAC,CACVH,EAAE,CAAEA,EAAG,CACP6B,KAAK,CAAE,mBAAmB,CAC1BC,OAAO,CAAE,IAAI,CACbC,UAAU,CAAE,EAAE,CACdC,MAAM,CAAE,CAAE/C,IAAI,CAAE,EAAE,CAAEK,KAAK,CAAE,EAAG,CAAC,CAC/B2C,YAAY,CAAE,CAAEhD,IAAI,CAAE,EAAG,CAAC,CAC1BiD,SAAS,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CACnCT,MAAM,CAAE,UACV,CAAC,CAAC,CACFhB,kBAAkB,CAAC,IAAI,CAAC,CACxBN,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CACF,CACA;AACAE,mBAAmB,CAAC,IAAI,CAAC,CACzBF,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CAEAF,WAAW,CAACsB,IAAI,CAACA,IAAI,CAAC,CACtBlB,mBAAmB,CAAC,KAAK,CAAC,CAAE;AAC5B,GAAIe,IAAI,CAAE,CACRX,kBAAkB,CAAC,IAAI,CAAC,CAC1B,CACF,CAAE,MAAO0B,KAAU,CAAE,KAAAC,eAAA,CAAAC,gBAAA,CACnBC,OAAO,CAACH,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAChD,GAAI,EAAAC,eAAA,CAAAD,KAAK,CAACd,QAAQ,UAAAe,eAAA,iBAAdA,eAAA,CAAgBX,MAAM,IAAK,GAAG,CAAE,CAClCpB,mBAAmB,CAAC,IAAI,CAAC,CACzBF,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CACQ,GAAI,EAAAkC,gBAAA,CAAAF,KAAK,CAACd,QAAQ,UAAAgB,gBAAA,iBAAdA,gBAAA,CAAgBZ,MAAM,IAAK,GAAG,CAAE,KAAAc,gBAAA,CAAAC,qBAAA,CACxC,IAAAD,gBAAA,CAAIJ,KAAK,CAACd,QAAQ,UAAAkB,gBAAA,YAAAC,qBAAA,CAAdD,gBAAA,CAAgBhB,IAAI,UAAAiB,qBAAA,WAApBA,qBAAA,CAAsBd,qBAAqB,CAAE,CAC/C;AACAzB,WAAW,CAAC,CACVH,EAAE,CAAEA,EAAG,CACP6B,KAAK,CAAE,iBAAiB,CACxBC,OAAO,CAAE,IAAI,CACbC,UAAU,CAAE,EAAE,CACdC,MAAM,CAAE,CAAE/C,IAAI,CAAE,EAAE,CAAEK,KAAK,CAAE,EAAG,CAAC,CAC/B2C,YAAY,CAAE,CAAEhD,IAAI,CAAE,EAAG,CAAC,CAC1BiD,SAAS,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CACnCT,MAAM,CAAE,iBACV,CAAC,CAAC,CACFhB,kBAAkB,CAAC,KAAK,CAAC,CACzBN,UAAU,CAAC,KAAK,CAAC,CACjB,OACJ,CAAC,IAAM,CACL;AACAF,WAAW,CAAC,CACVH,EAAE,CAAEA,EAAG,CACP6B,KAAK,CAAE,mBAAmB,CAC1BC,OAAO,CAAE,IAAI,CACbC,UAAU,CAAE,EAAE,CACdC,MAAM,CAAE,CAAE/C,IAAI,CAAE,EAAE,CAAEK,KAAK,CAAE,EAAG,CAAC,CAC/B2C,YAAY,CAAE,CAAEhD,IAAI,CAAE,EAAG,CAAC,CAC1BiD,SAAS,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CACnCT,MAAM,CAAE,UACV,CAAC,CAAC,CACFhB,kBAAkB,CAAC,IAAI,CAAC,CACxBN,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CACF,CACA;AACAE,mBAAmB,CAAC,IAAI,CAAC,CACzBF,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CAAC,OAAS,CACRA,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAAE,CAACL,EAAE,CAAC,CAAC,CAERpD,SAAS,CAAC,IAAM,CACd,KAAM,CAAA0E,IAAI,CAAGrB,YAAY,CAAC0C,GAAG,CAAC,YAAY,CAAC,CAC3C,GAAIrB,IAAI,CAAE,CACRb,aAAa,CAACa,IAAI,CAAC,CACnBD,aAAa,CAACC,IAAI,CAAC,CACrB,CAAC,IAAM,CACLD,aAAa,CAAC,CAAC,CACjB,CACF,CAAC,CAAE,CAACpB,YAAY,CAAEoB,aAAa,CAAC,CAAC,CAEjC,KAAM,CAAAuB,sBAAsB,CAAG,KAAO,CAAAzD,CAAkB,EAAK,CAC3DA,CAAC,CAAC0D,cAAc,CAAC,CAAC,CAClB,GAAIrC,UAAU,CAACsC,MAAM,GAAK,CAAC,CAAE,CAC3BrF,KAAK,CAAC4E,KAAK,CAAC,wCAAwC,CAAC,CACrD,OACF,CACA,KAAM,CAAAhB,aAAa,CAACb,UAAU,CAAC,CACjC,CAAC,CAED,KAAM,CAAAuC,oBAAoB,CAAG,KAAO,CAAAC,MAAwC,EAAK,CAC/E,GAAIA,MAAM,GAAK,SAAS,EAAI,CAAChC,OAAO,CAACiC,IAAI,CAAC,CAAC,CAAE,CAC3CxF,KAAK,CAAC4E,KAAK,CAAC,wBAAwB,CAAC,CACrC,OACF,CAEA,GAAI,CACFxB,qBAAqB,CAAC,IAAI,CAAC,CAC3B,KAAM,CAAAU,QAAQ,CAAG,KAAM,CAAA7D,SAAS,CAACwF,cAAc,CAAClD,EAAE,CAAG,CACnDQ,UAAU,CACVwC,MAAM,CACNhC,OAAO,CAAEgC,MAAM,GAAK,SAAS,CAAGhC,OAAO,CAAGmC,SAC5C,CAAC,CAAC,CAEF,KAAM,CAAA1B,IAAI,CAAGF,QAAQ,CAACE,IAAI,CAE1B,GAAI,CAACA,IAAI,CAACC,OAAO,CAAE,CACjB,KAAM,IAAI,CAAA0B,KAAK,CAAC3B,IAAI,CAACY,KAAK,EAAI,2BAA2B,CAAC,CAC5D,CAEA5E,KAAK,CAACiE,OAAO,CACXsB,MAAM,GAAK,SAAS,CAAG,oBAAoB,CAC3CA,MAAM,GAAK,QAAQ,CAAG,oBAAoB,CAC1C,iCACF,CAAC,CAED;AACA,GAAI9C,QAAQ,CAAE,CACZC,WAAW,CAAC,CACV,GAAGD,QAAQ,CACXyB,MAAM,CAAEqB,MAAM,GAAK,SAAS,CAAG,UAAU,CAAGA,MAAM,GAAK,QAAQ,CAAG,UAAU,CAAG,WACjF,CAAC,CAAC,CACJ,CAEAjC,iBAAiB,CAAC,IAAI,CAAC,CACvBE,UAAU,CAAC,EAAE,CAAC,CAChB,CAAE,MAAOoB,KAAK,CAAE,CACdG,OAAO,CAACH,KAAK,CAAC,4BAA4B,CAAEA,KAAK,CAAC,CAClD5E,KAAK,CAAC4E,KAAK,CAAC,2BAA2B,CAAC,CAC1C,CAAC,OAAS,CACRxB,qBAAqB,CAAC,KAAK,CAAC,CAC9B,CACF,CAAC,CAED,KAAM,CAAAwC,YAAY,CAAIvB,OAAe,EAAK,CACxC,GAAI,CACF,MAAO,CAAAwB,IAAI,CAACC,KAAK,CAACzB,OAAO,CAAC,CAC5B,CAAE,KAAM,CACN,MAAO,CAAE0B,gBAAgB,CAAE1B,OAAQ,CAAC,CACtC,CACF,CAAC,CAED,KAAM,CAAA2B,mBAAmB,CAAG,KAAO,CAAAtE,CAAkB,EAAK,CACxDA,CAAC,CAAC0D,cAAc,CAAC,CAAC,CAElB;AACA,KAAM,CAAAa,YAAY,CAAG,CAAAxD,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEyB,MAAM,IAAK,UAAU,EAAI,CAAAzB,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEyB,MAAM,IAAK,UAAU,EAAI,CAAAzB,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEyB,MAAM,IAAK,SAAS,EAAI,CAAAzB,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEyB,MAAM,IAAK,iBAAiB,CAInK,GAAI,CAAC+B,YAAY,GAAK,CAACrF,iBAAiB,CAACY,IAAI,CAACgE,IAAI,CAAC,CAAC,EAAI,CAAC5E,iBAAiB,CAACiB,KAAK,CAAC2D,IAAI,CAAC,CAAC,CAAC,CAAE,CACxFxF,KAAK,CAAC4E,KAAK,CAAC,oCAAoC,CAAC,CACjD,OACF,CAEA,GAAIqB,YAAY,EAAI,CAACrF,iBAAiB,CAACmB,MAAM,CAACyD,IAAI,CAAC,CAAC,CAAE,CACpDxF,KAAK,CAAC4E,KAAK,CAAC,+CAA+C,CAAC,CAC5D,OACF,CAEA,GAAI,CACFjB,oBAAoB,CAAC,IAAI,CAAC,CAE1B;AACA,KAAM,CAAAuC,WAAW,CAAGD,YAAY,CAAG,CACjCzE,IAAI,CAAE,CAAAiB,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAE6B,UAAU,GAAI,SAAS,CACvCzC,KAAK,CAAE,CAAAY,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAE0D,cAAc,GAAI,SAAS,CAC5CrE,OAAO,CAAElB,iBAAiB,CAACkB,OAAO,CAAC0D,IAAI,CAAC,CAAC,CACzCzD,MAAM,CAAEnB,iBAAiB,CAACmB,MAAM,CAACyD,IAAI,CAAC,CACxC,CAAC,CAAG,CACFhE,IAAI,CAAEZ,iBAAiB,CAACY,IAAI,CAACgE,IAAI,CAAC,CAAC,CACnC3D,KAAK,CAAEjB,iBAAiB,CAACiB,KAAK,CAAC2D,IAAI,CAAC,CAAC,CACrC1D,OAAO,CAAElB,iBAAiB,CAACkB,OAAO,CAAC0D,IAAI,CAAC,CAAC,CACzCzD,MAAM,CAAEnB,iBAAiB,CAACmB,MAAM,CAACyD,IAAI,CAAC,CACxC,CAAC,CAED;AACA,KAAM,CAAA1B,QAAQ,CAAG,KAAM,CAAAsC,KAAK,CAAC,8CAA8C7D,EAAE,iBAAiB,CAAE,CAC9F8D,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEV,IAAI,CAACW,SAAS,CAACN,WAAW,CAClC,CAAC,CAAC,CAEF,KAAM,CAAAlC,IAAI,CAAG,KAAM,CAAAF,QAAQ,CAAC2C,IAAI,CAAC,CAAC,CAElC,GAAIzC,IAAI,CAACC,OAAO,CAAE,CAChBjE,KAAK,CAACiE,OAAO,CAAC,gFAAgF,CAAC,CAC/FP,oBAAoB,CAAC,KAAK,CAAC,CAC3B7C,oBAAoB,CAAC,CAAEW,IAAI,CAAE,EAAE,CAAEK,KAAK,CAAE,EAAE,CAAEC,OAAO,CAAE,EAAE,CAAEC,MAAM,CAAE,EAAG,CAAC,CAAC,CACxE,CAAC,IAAM,CACL,KAAM,IAAI,CAAA4D,KAAK,CAAC3B,IAAI,CAACY,KAAK,EAAI,+BAA+B,CAAC,CAChE,CACF,CAAE,MAAOA,KAAK,CAAE,CACdG,OAAO,CAACH,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAChD5E,KAAK,CAAC4E,KAAK,CAAC,kDAAkD,CAAC,CACjE,CAAC,OAAS,CACRjB,oBAAoB,CAAC,KAAK,CAAC,CAC7B,CACF,CAAC,CAED,GAAIhB,OAAO,CAAE,CACX,mBACEvC,IAAA,QAAKe,SAAS,CAAC,qGAAqG,CAAAC,QAAA,cAClHd,KAAA,QAAKa,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BhB,IAAA,QAAKe,SAAS,CAAC,wEAAwE,CAAM,CAAC,cAC9Ff,IAAA,MAAGe,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,qBAAmB,CAAG,CAAC,EACtD,CAAC,CACH,CAAC,CAEV,CAEA;AACA2D,OAAO,CAAC2B,GAAG,CAAC,8BAA8B,CAAE,CAC1C7D,gBAAgB,CAChBI,eAAe,CACfN,OAAO,CACPc,iBAAiB,CACjBhB,QAAQ,CAAEA,QAAQ,CAAG,QAAQ,CAAG,MAClC,CAAC,CAAC,CAEF,GAAII,gBAAgB,EAAI,CAACI,eAAe,CAAE,CACxC,mBACE7C,IAAA,QAAKe,SAAS,CAAC,yGAAyG,CAAAC,QAAA,cACtHd,KAAA,QAAKa,SAAS,CAAC,oDAAoD,CAAAC,QAAA,eACjEd,KAAA,QAAKa,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/BhB,IAAA,QAAKe,SAAS,CAAC,kFAAkF,CAAAC,QAAA,cAC/FhB,IAAA,CAACV,cAAc,EAACyB,SAAS,CAAC,uBAAuB,CAAE,CAAC,CACjD,CAAC,cACNf,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,wBAAsB,CAAI,CAAC,cACjFhB,IAAA,MAAGe,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAC,0EAAwE,CAAG,CAAC,EACtG,CAAC,cAENd,KAAA,SAAMK,QAAQ,CAAEwE,sBAAuB,CAAChE,SAAS,CAAC,WAAW,CAAAC,QAAA,eAC3Dd,KAAA,QAAAc,QAAA,eACEhB,IAAA,UAAOuG,OAAO,CAAC,YAAY,CAACxF,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CAAC,aAErF,CAAO,CAAC,cACRhB,IAAA,UACEiB,IAAI,CAAC,MAAM,CACXkB,EAAE,CAAC,YAAY,CACfhB,KAAK,CAAEwB,UAAW,CAClBtB,QAAQ,CAAGC,CAAC,EAAKsB,aAAa,CAACtB,CAAC,CAACC,MAAM,CAACJ,KAAK,CAACqF,WAAW,CAAC,CAAC,CAAE,CAC7DC,SAAS,CAAE,CAAE,CACb1F,SAAS,CAAC,yJAAyJ,CACnKS,WAAW,CAAC,QAAQ,CACpBkF,YAAY,CAAC,KAAK,CACnB,CAAC,EACC,CAAC,cACN1G,IAAA,WACEiB,IAAI,CAAC,QAAQ,CACbY,QAAQ,CAAEc,UAAU,CAACsC,MAAM,GAAK,CAAE,CAClClE,SAAS,CAAC,kMAAkM,CAAAC,QAAA,CAC7M,iBAED,CAAQ,CAAC,EACL,CAAC,cAEPd,KAAA,QAAKa,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/BhB,IAAA,MAAGe,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CAAC,sEAE1C,CAAG,CAAC,cACJhB,IAAA,WACEiB,IAAI,CAAC,QAAQ,CACba,OAAO,CAAEA,CAAA,GAAMwB,oBAAoB,CAAC,IAAI,CAAE,CAC1CvC,SAAS,CAAC,iEAAiE,CAAAC,QAAA,CAC5E,iCAED,CAAQ,CAAC,EACN,CAAC,EACH,CAAC,CACH,CAAC,CAEV,CAEA,GAAIqC,iBAAiB,CAAE,CACrB,mBACErD,IAAA,CAACK,iBAAiB,EAChBE,QAAQ,CAAEqF,mBAAoB,CAC9BpF,iBAAiB,CAAEA,iBAAkB,CACrCC,oBAAoB,CAAEA,oBAAqB,CAC3CC,iBAAiB,CAAEA,iBAAkB,CACrCC,QAAQ,CAAEA,CAAA,GAAM2C,oBAAoB,CAAC,KAAK,CAAE,CAC5C1C,UAAU,CAAE,IAAK,CAClB,CAAC,CAEN,CAEA,GAAI,CAACyB,QAAQ,CAAE,CACb,mBACErC,IAAA,QAAKe,SAAS,CAAC,qGAAqG,CAAAC,QAAA,cAClHd,KAAA,QAAKa,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BhB,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,oBAAkB,CAAI,CAAC,cAC7EhB,IAAA,MAAGe,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAC,oEAAkE,CAAG,CAAC,EAChG,CAAC,CACH,CAAC,CAEV,CAEA,KAAM,CAAAiD,OAAO,CAAGuB,YAAY,CAACnD,QAAQ,CAAC4B,OAAO,CAAC,CAE9C;AACA,KAAM,CAAA0C,YAAY,CAAGtE,QAAQ,CAACyB,MAAM,GAAK,UAAU,EAAIzB,QAAQ,CAACyB,MAAM,GAAK,UAAU,EAAIzB,QAAQ,CAACyB,MAAM,GAAK,SAAS,EAAIzB,QAAQ,CAACyB,MAAM,GAAK,iBAAiB,CAE/J;AACA;AACA;AACA,KAAM,CAAA8C,gBAAgB,CAAG/D,eAAe,CAExC,mBACE3C,KAAA,QAAKa,SAAS,CAAC,oEAAoE,CAAAC,QAAA,eAEjFhB,IAAA,QAAKe,SAAS,CAAC,6CAA6C,CAAAC,QAAA,cAC1DhB,IAAA,QAAKe,SAAS,CAAC,6CAA6C,CAAAC,QAAA,cAC1Dd,KAAA,QAAKa,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAChDd,KAAA,QAAKa,SAAS,CAAC,6BAA6B,CAAAC,QAAA,EACzC,CAAAgB,qBAAA,CAAAK,QAAQ,CAAC+B,YAAY,UAAApC,qBAAA,WAArBA,qBAAA,CAAuB6E,IAAI,cAC1B7G,IAAA,QAAK8G,GAAG,CAAEzE,QAAQ,CAAC+B,YAAY,CAACyC,IAAK,CAACE,GAAG,CAAC,MAAM,CAAChG,SAAS,CAAC,aAAa,CAAE,CAAC,cAE3Ef,IAAA,QAAKe,SAAS,CAAC,mEAAmE,CAAAC,QAAA,cAChFhB,IAAA,CAACL,kBAAkB,EAACoB,SAAS,CAAC,oBAAoB,CAAE,CAAC,CAClD,CACN,cACDb,KAAA,QAAAc,QAAA,eACEhB,IAAA,OAAIe,SAAS,CAAC,iCAAiC,CAAAC,QAAA,CAAE,EAAAiB,sBAAA,CAAAI,QAAQ,CAAC+B,YAAY,UAAAnC,sBAAA,iBAArBA,sBAAA,CAAuBb,IAAI,GAAI,YAAY,CAAK,CAAC,cAClGpB,IAAA,MAAGe,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,uBAAqB,CAAG,CAAC,EAC3D,CAAC,EACH,CAAC,cACNd,KAAA,QAAKa,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzBhB,IAAA,MAAGe,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,SAAO,CAAG,CAAC,cAChDhB,IAAA,MAAGe,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAC7C,GAAI,CAAAsD,IAAI,CAACjC,QAAQ,CAAC2E,WAAW,EAAI3E,QAAQ,CAACgC,SAAS,CAAC,CAAC4C,kBAAkB,CAAC,CAAC,CACzE,CAAC,EACD,CAAC,EACH,CAAC,CACH,CAAC,CACH,CAAC,cAEN/G,KAAA,QAAKa,SAAS,CAAC,6CAA6C,CAAAC,QAAA,EAEzD4F,gBAAgB,EAAI,CAACD,YAAY,cAChCzG,KAAA,QAAKa,SAAS,CAAC,yCAAyC,CAAAC,QAAA,eACtDd,KAAA,QAAKa,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/BhB,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAEqB,QAAQ,CAAC2B,KAAK,CAAK,CAAC,cAC3E9D,KAAA,MAAGa,SAAS,CAAC,uBAAuB,CAAAC,QAAA,EAAC,eAAa,CAACqB,QAAQ,CAAC6B,UAAU,EAAI,CAAC,EACxE,CAAC,cAENhE,KAAA,QAAKa,SAAS,CAAC,4CAA4C,CAAAC,QAAA,eACzDd,KAAA,QAAKa,SAAS,CAAC,6BAA6B,CAAAC,QAAA,eAC1ChB,IAAA,CAACP,QAAQ,EAACsB,SAAS,CAAC,uBAAuB,CAAE,CAAC,cAC9Cb,KAAA,QAAAc,QAAA,eACEhB,IAAA,MAAGe,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,aAAW,CAAG,CAAC,cACpDhB,IAAA,MAAGe,SAAS,CAAC,2BAA2B,CAAAC,QAAA,CACrCqB,QAAQ,CAAC8B,MAAM,CAAC/C,IAAI,EAAIiB,QAAQ,CAAC8B,MAAM,CAAC1C,KAAK,EAAI,SAAS,CAC1D,CAAC,EACD,CAAC,EACH,CAAC,cACNvB,KAAA,QAAKa,SAAS,CAAC,6BAA6B,CAAAC,QAAA,eAC1ChB,IAAA,CAACN,YAAY,EAACqB,SAAS,CAAC,uBAAuB,CAAE,CAAC,cAClDb,KAAA,QAAAc,QAAA,eACEhB,IAAA,MAAGe,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,YAAU,CAAG,CAAC,cACnDhB,IAAA,MAAGe,SAAS,CAAC,2BAA2B,CAAAC,QAAA,CACrC,GAAI,CAAAsD,IAAI,CAACjC,QAAQ,CAACgC,SAAS,CAAC,CAAC4C,kBAAkB,CAAC,CAAC,CACjD,CAAC,EACD,CAAC,EACH,CAAC,cACN/G,KAAA,QAAKa,SAAS,CAAC,6BAA6B,CAAAC,QAAA,eAC1ChB,IAAA,CAACR,gBAAgB,EAACuB,SAAS,CAAC,uBAAuB,CAAE,CAAC,cACtDb,KAAA,QAAAc,QAAA,eACEhB,IAAA,MAAGe,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,QAAM,CAAG,CAAC,cAC/ChB,IAAA,MAAGe,SAAS,CAAE,eACZsB,QAAQ,CAACyB,MAAM,GAAK,UAAU,CAAG,gBAAgB,CACjDzB,QAAQ,CAACyB,MAAM,GAAK,UAAU,CAAG,cAAc,CAC/CzB,QAAQ,CAACyB,MAAM,GAAK,WAAW,CAAG,iBAAiB,CACnD,eAAe,EACd,CAAA9C,QAAA,CACAqB,QAAQ,CAACyB,MAAM,GAAK,UAAU,CAAG,UAAU,CAC3CzB,QAAQ,CAACyB,MAAM,GAAK,UAAU,CAAG,UAAU,CAC3CzB,QAAQ,CAACyB,MAAM,GAAK,WAAW,CAAG,cAAc,CAChD,kBAAkB,CAClB,CAAC,EACD,CAAC,EACH,CAAC,EACH,CAAC,EACH,CAAC,CACJ,IAAI,CAGP8C,gBAAgB,GAAK3C,OAAO,CAAC0B,gBAAgB,EAAI1B,OAAO,CAACiD,QAAQ,EAAIjD,OAAO,CAACkD,aAAa,EAAIlD,OAAO,CAACmD,QAAQ,EAAInD,OAAO,CAACoD,MAAM,CAAC,eAChIrH,IAAA,QAAKe,SAAS,CAAC,yCAAyC,CAAAC,QAAA,cACtDd,KAAA,QAAKa,SAAS,CAAC,kBAAkB,CAAAC,QAAA,EAC9BiD,OAAO,CAAC0B,gBAAgB,eACvBzF,KAAA,QAAKa,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBhB,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,mBAAiB,CAAI,CAAC,cAC5EhB,IAAA,QAAKe,SAAS,CAAC,2BAA2B,CAAAC,QAAA,cACxChB,IAAA,MAAGe,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAAEiD,OAAO,CAAC0B,gBAAgB,CAAI,CAAC,CAC5F,CAAC,EACH,CACN,CAEA1B,OAAO,CAACiD,QAAQ,eACfhH,KAAA,QAAKa,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBhB,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,cAAY,CAAI,CAAC,cACvEhB,IAAA,QAAKe,SAAS,CAAC,2BAA2B,CAAAC,QAAA,cACxChB,IAAA,MAAGe,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAAEiD,OAAO,CAACiD,QAAQ,CAAI,CAAC,CACpF,CAAC,EACH,CACN,CAEAjD,OAAO,CAACkD,aAAa,eACpBjH,KAAA,QAAKa,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBhB,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,gBAAc,CAAI,CAAC,cACzEhB,IAAA,QAAKe,SAAS,CAAC,2BAA2B,CAAAC,QAAA,cACxChB,IAAA,MAAGe,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAAEiD,OAAO,CAACkD,aAAa,CAAI,CAAC,CACzF,CAAC,EACH,CACN,CAEAlD,OAAO,CAACmD,QAAQ,eACflH,KAAA,QAAKa,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBhB,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,UAAQ,CAAI,CAAC,cACnEhB,IAAA,QAAKe,SAAS,CAAC,2BAA2B,CAAAC,QAAA,cACxChB,IAAA,MAAGe,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAAEiD,OAAO,CAACmD,QAAQ,CAAI,CAAC,CACpF,CAAC,EACH,CACN,CAEAnD,OAAO,CAACoD,MAAM,eACbnH,KAAA,QAAKa,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBhB,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,YAAU,CAAI,CAAC,cACrEhB,IAAA,QAAKe,SAAS,CAAC,sDAAsD,CAAAC,QAAA,cACnEhB,IAAA,MAAGe,SAAS,CAAC,kCAAkC,CAAAC,QAAA,CAAEiD,OAAO,CAACoD,MAAM,CAAI,CAAC,CACjE,CAAC,EACH,CACN,EACE,CAAC,CACH,CACN,CAGAV,YAAY,EAAI,CAACC,gBAAgB,eAChC5G,IAAA,QAAKe,SAAS,CAAC,sEAAsE,CAAAC,QAAA,cACnFd,KAAA,QAAKa,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BhB,IAAA,CAACV,cAAc,EAACyB,SAAS,CAAC,wCAAwC,CAAE,CAAC,cACrEf,IAAA,OAAIe,SAAS,CAAC,yCAAyC,CAAAC,QAAA,CAAC,yBAAuB,CAAI,CAAC,cACpFhB,IAAA,MAAGe,SAAS,CAAC,sBAAsB,CAAAC,QAAA,CAChCqB,QAAQ,CAACyB,MAAM,GAAK,iBAAiB,CAClC,0HAA0H,CAC1H,0BAA0B,EAAA5B,gBAAA,CAAAG,QAAQ,CAACyB,MAAM,UAAA5B,gBAAA,iBAAfA,gBAAA,CAAiBoF,WAAW,CAAC,CAAC,GAAI,UAAU,qFAAqF,CAE9J,CAAC,cAGJtH,IAAA,CAACK,iBAAiB,EAChBE,QAAQ,CAAEqF,mBAAoB,CAC9BpF,iBAAiB,CAAEA,iBAAkB,CACrCC,oBAAoB,CAAEA,oBAAqB,CAC3CC,iBAAiB,CAAEA,iBAAkB,CACrCG,UAAU,CAAE,IAAK,CAClB,CAAC,EACC,CAAC,CACH,CACN,CAGAwB,QAAQ,CAACyB,MAAM,GAAK,UAAU,EAAI8C,gBAAgB,cACjD5G,IAAA,QAAKe,SAAS,CAAC,oEAAoE,CAAAC,QAAA,cACjFd,KAAA,QAAKa,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BhB,IAAA,CAACb,eAAe,EAAC4B,SAAS,CAAC,uCAAuC,CAAE,CAAC,cACrEf,IAAA,OAAIe,SAAS,CAAC,wCAAwC,CAAAC,QAAA,CAAC,oBAAkB,CAAI,CAAC,cAC9EhB,IAAA,MAAGe,SAAS,CAAC,qBAAqB,CAAAC,QAAA,CAAC,8FAA4F,CAAG,CAAC,EAChI,CAAC,CACH,CAAC,CACJqB,QAAQ,CAACyB,MAAM,GAAK,UAAU,EAAI8C,gBAAgB,cACpD5G,IAAA,QAAKe,SAAS,CAAC,gEAAgE,CAAAC,QAAA,cAC7Ed,KAAA,QAAKa,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BhB,IAAA,CAACZ,WAAW,EAAC2B,SAAS,CAAC,qCAAqC,CAAE,CAAC,cAC/Df,IAAA,OAAIe,SAAS,CAAC,sCAAsC,CAAAC,QAAA,CAAC,mBAAiB,CAAI,CAAC,cAC3EhB,IAAA,MAAGe,SAAS,CAAC,mBAAmB,CAAAC,QAAA,CAAC,yFAAuF,CAAG,CAAC,EACzH,CAAC,CACH,CAAC,CACJqB,QAAQ,CAACyB,MAAM,GAAK,SAAS,EAAI8C,gBAAgB,cACnD5G,IAAA,QAAKe,SAAS,CAAC,sEAAsE,CAAAC,QAAA,cACnFd,KAAA,QAAKa,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BhB,IAAA,CAACN,YAAY,EAACqB,SAAS,CAAC,wCAAwC,CAAE,CAAC,cACnEf,IAAA,OAAIe,SAAS,CAAC,yCAAyC,CAAAC,QAAA,CAAC,kBAAgB,CAAI,CAAC,cAC7EhB,IAAA,MAAGe,SAAS,CAAC,sBAAsB,CAAAC,QAAA,CAAC,8FAA4F,CAAG,CAAC,EACjI,CAAC,CACH,CAAC,CACJ,CAAC2F,YAAY,cACfzG,KAAA,QAAKa,SAAS,CAAC,yCAAyC,CAAAC,QAAA,eACtDhB,IAAA,OAAIe,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,uBAAqB,CAAI,CAAC,cAEhFd,KAAA,QAAKa,SAAS,CAAC,4CAA4C,CAAAC,QAAA,eACzDd,KAAA,WACE4B,OAAO,CAAEA,CAAA,GAAMoB,iBAAiB,CAAC,SAAS,CAAE,CAC5CnC,SAAS,CAAC,yIAAyI,CAAAC,QAAA,eAEnJhB,IAAA,CAACb,eAAe,EAAC4B,SAAS,CAAC,wBAAwB,CAAE,CAAC,cACtDf,IAAA,SAAMe,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CAAC,SAAO,CAAM,CAAC,EACrD,CAAC,cAETd,KAAA,WACE4B,OAAO,CAAEA,CAAA,GAAMoB,iBAAiB,CAAC,QAAQ,CAAE,CAC3CnC,SAAS,CAAC,mIAAmI,CAAAC,QAAA,eAE7IhB,IAAA,CAACZ,WAAW,EAAC2B,SAAS,CAAC,sBAAsB,CAAE,CAAC,cAChDf,IAAA,SAAMe,SAAS,CAAC,0BAA0B,CAAAC,QAAA,CAAC,QAAM,CAAM,CAAC,EAClD,CAAC,cAETd,KAAA,WACE4B,OAAO,CAAEA,CAAA,GAAMoB,iBAAiB,CAAC,SAAS,CAAE,CAC5CnC,SAAS,CAAC,sIAAsI,CAAAC,QAAA,eAEhJhB,IAAA,CAACX,kBAAkB,EAAC0B,SAAS,CAAC,uBAAuB,CAAE,CAAC,cACxDf,IAAA,SAAMe,SAAS,CAAC,2BAA2B,CAAAC,QAAA,CAAC,SAAO,CAAM,CAAC,EACpD,CAAC,EACN,CAAC,CAELiC,cAAc,GAAK,SAAS,eAC3B/C,KAAA,QAAKa,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBhB,IAAA,UAAOuG,OAAO,CAAC,SAAS,CAACxF,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CAAC,eAElF,CAAO,CAAC,cACRhB,IAAA,aACEmC,EAAE,CAAC,SAAS,CACZhB,KAAK,CAAEgC,OAAQ,CACf9B,QAAQ,CAAGC,CAAC,EAAK8B,UAAU,CAAC9B,CAAC,CAACC,MAAM,CAACJ,KAAK,CAAE,CAC5CS,IAAI,CAAE,CAAE,CACRb,SAAS,CAAC,2GAA2G,CACrHS,WAAW,CAAC,+DAA+D,CAC5E,CAAC,EACC,CACN,CAEAyB,cAAc,eACb/C,KAAA,QAAKa,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7Bd,KAAA,WACE4B,OAAO,CAAEA,CAAA,GAAMoD,oBAAoB,CAACjC,cAAc,CAAE,CACpDpB,QAAQ,CAAEkB,kBAAmB,CAC7BhC,SAAS,CAAC,2LAA2L,CAAAC,QAAA,EAEpM+B,kBAAkB,cACjB/C,IAAA,QAAKe,SAAS,CAAC,2DAA2D,CAAM,CAAC,cAEjFf,IAAA,CAACT,cAAc,EAACwB,SAAS,CAAC,SAAS,CAAE,CACtC,cACDf,IAAA,SAAAgB,QAAA,CACGiC,cAAc,GAAK,SAAS,CAAG,kBAAkB,CACjDA,cAAc,GAAK,QAAQ,CAAG,iBAAiB,CAC/C,gBAAgB,CACb,CAAC,EACD,CAAC,cAETjD,IAAA,WACE8B,OAAO,CAAEA,CAAA,GAAM,CACboB,iBAAiB,CAAC,IAAI,CAAC,CACvBE,UAAU,CAAC,EAAE,CAAC,CAChB,CAAE,CACFrC,SAAS,CAAC,qGAAqG,CAAAC,QAAA,CAChH,QAED,CAAQ,CAAC,EACN,CACN,EACE,CAAC,CACJ,IAAI,CAGP4F,gBAAgB,EAAI,CAACD,YAAY,eAChC3G,IAAA,CAACF,cAAc,EACbyH,UAAU,CAAElF,QAAQ,CAACF,EAAG,CACxBQ,UAAU,CAAEA,UAAW,CACvBuB,UAAU,CAAE7B,QAAQ,CAAC6B,UAAW,CAChCsD,WAAW,CAAEnF,QAAQ,CAAC0D,cAAe,CACtC,CACF,EACE,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAhE,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}