{"ast":null,"code":"var _jsxFileName = \"/Users/davnishsingh/Documents/proposalai-main/proposalai/client/src/components/NotificationBell.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { BellIcon, ChatBubbleLeftIcon, EyeIcon, CheckCircleIcon, XCircleIcon, UserIcon, ClockIcon } from '@heroicons/react/24/outline';\nimport { notificationAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { useAuth } from '../hooks/useAuth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function NotificationBell() {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const navigate = useNavigate();\n  const [notifications, setNotifications] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [isOpen, setIsOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(false);\n\n  // Rate limiting and backoff state\n  const [isRateLimited, setIsRateLimited] = useState(false);\n  const [retryCount, setRetryCount] = useState(0);\n  const lastFetchTime = useRef(0);\n  const intervalRef = useRef(null);\n  useEffect(() => {\n    if (user) {\n      fetchNotifications();\n      fetchUnreadCount();\n\n      // Poll for new notifications every 2 minutes (120 seconds) instead of 30 seconds\n      intervalRef.current = setInterval(() => {\n        // Only fetch if not rate limited and enough time has passed\n        const now = Date.now();\n        if (!isRateLimited && now - lastFetchTime.current > 60000) {\n          // 1 minute minimum between calls\n          fetchUnreadCount();\n          fetchNotifications(); // Also fetch the full notification list\n          lastFetchTime.current = now;\n        }\n      }, 120000); // 2 minutes\n\n      return () => {\n        if (intervalRef.current) {\n          clearInterval(intervalRef.current);\n        }\n      };\n    }\n  }, [user, isRateLimited]);\n  const fetchNotifications = async () => {\n    try {\n      setLoading(true);\n      setError(false);\n      setIsRateLimited(false);\n      setRetryCount(0);\n      const response = await notificationAPI.getAll();\n      if (response.data.success) {\n        setNotifications(response.data.data);\n      }\n    } catch (error) {\n      var _error$response, _error$message;\n      console.error('Failed to fetch notifications:', error);\n      setError(true);\n\n      // Handle rate limiting\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 429 || (_error$message = error.message) !== null && _error$message !== void 0 && _error$message.includes('Too many requests')) {\n        setIsRateLimited(true);\n        // Exponential backoff: wait 2^retryCount minutes\n        const backoffTime = Math.min(Math.pow(2, retryCount) * 60000, 300000); // Max 5 minutes\n        setTimeout(() => {\n          setIsRateLimited(false);\n          setRetryCount(prev => prev + 1);\n        }, backoffTime);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n  const fetchUnreadCount = async () => {\n    try {\n      // Skip if rate limited\n      if (isRateLimited) {\n        return;\n      }\n      const response = await notificationAPI.getUnreadCount();\n      if (response.data.success) {\n        setUnreadCount(response.data.data.unreadCount);\n        setIsRateLimited(false);\n        setRetryCount(0);\n      }\n    } catch (error) {\n      var _error$response2, _error$message2;\n      console.error('Failed to fetch unread count:', error);\n\n      // Handle rate limiting\n      if (((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) === 429 || (_error$message2 = error.message) !== null && _error$message2 !== void 0 && _error$message2.includes('Too many requests')) {\n        setIsRateLimited(true);\n        // Exponential backoff: wait 2^retryCount minutes\n        const backoffTime = Math.min(Math.pow(2, retryCount) * 60000, 300000); // Max 5 minutes\n        setTimeout(() => {\n          setIsRateLimited(false);\n          setRetryCount(prev => prev + 1);\n        }, backoffTime);\n      }\n      // Don't set error here as we still want to show the bell\n    }\n  };\n  const handleNotificationClick = async notification => {\n    try {\n      // Mark as read first\n      await markAsRead(notification.id);\n\n      // Close the dropdown\n      setIsOpen(false);\n\n      // Navigate based on notification type\n      switch (notification.type) {\n        case 'COMMENT':\n        case 'CLIENT_REPLY':\n          if (notification.proposalId) {\n            // Navigate to proposal with comments tab\n            navigate(`/proposals/${notification.proposalId}/view?tab=comments`);\n            toast.success('Navigating to comments...');\n          } else {\n            navigate('/sent-proposals');\n            toast('Proposal not found, showing sent proposals');\n          }\n          break;\n        case 'PROPOSAL_OPENED':\n        case 'PROPOSAL_APPROVED':\n        case 'PROPOSAL_REJECTED':\n          if (notification.proposalId) {\n            // Navigate to proposal view\n            navigate(`/proposals/${notification.proposalId}/view`);\n            toast.success('Navigating to proposal...');\n          } else {\n            navigate('/sent-proposals');\n            toast('Proposal not found, showing sent proposals');\n          }\n          break;\n        case 'ACCESS_REQUEST':\n          if (notification.proposalId) {\n            // Navigate to proposal with activity tab\n            navigate(`/proposals/${notification.proposalId}/view?tab=activity`);\n            toast.success('Navigating to proposal activity...');\n          } else {\n            navigate('/sent-proposals');\n            toast('Proposal not found, showing sent proposals');\n          }\n          break;\n        default:\n          // Fallback to sent proposals\n          navigate('/sent-proposals');\n          toast('Navigating to sent proposals');\n          break;\n      }\n    } catch (error) {\n      console.error('Failed to handle notification click:', error);\n      toast.error('Failed to navigate to notification. Please try again.');\n      // Still close the dropdown even if navigation fails\n      setIsOpen(false);\n    }\n  };\n  const markAsRead = async notificationId => {\n    try {\n      await notificationAPI.markAsRead(notificationId);\n      setNotifications(prev => prev.map(notif => notif.id === notificationId ? {\n        ...notif,\n        isRead: true\n      } : notif));\n      setUnreadCount(prev => Math.max(0, prev - 1));\n    } catch (error) {\n      console.error('Failed to mark notification as read:', error);\n    }\n  };\n  const markAllAsRead = async () => {\n    try {\n      await notificationAPI.markAllAsRead();\n      setNotifications(prev => prev.map(notif => ({\n        ...notif,\n        isRead: true\n      })));\n      setUnreadCount(0);\n      toast.success('All notifications marked as read');\n    } catch (error) {\n      console.error('Failed to mark all notifications as read:', error);\n      toast.error('Failed to mark notifications as read');\n    }\n  };\n  const getNotificationIcon = type => {\n    switch (type) {\n      case 'COMMENT':\n        return /*#__PURE__*/_jsxDEV(ChatBubbleLeftIcon, {\n          className: \"h-5 w-5 text-blue-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 16\n        }, this);\n      case 'PROPOSAL_OPENED':\n        return /*#__PURE__*/_jsxDEV(EyeIcon, {\n          className: \"h-5 w-5 text-green-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 16\n        }, this);\n      case 'PROPOSAL_APPROVED':\n        return /*#__PURE__*/_jsxDEV(CheckCircleIcon, {\n          className: \"h-5 w-5 text-green-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 16\n        }, this);\n      case 'PROPOSAL_REJECTED':\n        return /*#__PURE__*/_jsxDEV(XCircleIcon, {\n          className: \"h-5 w-5 text-red-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 16\n        }, this);\n      case 'CLIENT_REPLY':\n        return /*#__PURE__*/_jsxDEV(UserIcon, {\n          className: \"h-5 w-5 text-purple-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 16\n        }, this);\n      case 'ACCESS_REQUEST':\n        return /*#__PURE__*/_jsxDEV(UserIcon, {\n          className: \"h-5 w-5 text-orange-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 16\n        }, this);\n      default:\n        return /*#__PURE__*/_jsxDEV(BellIcon, {\n          className: \"h-5 w-5 text-gray-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 16\n        }, this);\n    }\n  };\n  const formatTimeAgo = dateString => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diffInMinutes = Math.floor((now.getTime() - date.getTime()) / (1000 * 60));\n    if (diffInMinutes < 1) return 'Just now';\n    if (diffInMinutes < 60) return `${diffInMinutes}m ago`;\n    if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;\n    return `${Math.floor(diffInMinutes / 1440)}d ago`;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => setIsOpen(!isOpen),\n      className: `relative p-2 rounded-lg transition-colors ${isRateLimited ? 'text-yellow-300 hover:text-yellow-200 hover:bg-yellow-900/20' : 'text-white/80 hover:text-white hover:bg-white/10'}`,\n      title: isRateLimited ? \"Rate limited - notifications temporarily unavailable\" : user ? \"Notifications\" : \"Login to see notifications\",\n      children: [/*#__PURE__*/_jsxDEV(BellIcon, {\n        className: \"h-6 w-6\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), user && unreadCount > 0 && !isRateLimited && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium\",\n        children: unreadCount > 99 ? '99+' : unreadCount\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 11\n      }, this), isRateLimited && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"absolute -bottom-1 -right-1 bg-yellow-500 text-white text-xs rounded-full h-3 w-3 flex items-center justify-center\",\n        children: \"\\u23F1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 11\n      }, this), error && !isRateLimited && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"absolute -bottom-1 -right-1 bg-yellow-400 text-white text-xs rounded-full h-3 w-3 flex items-center justify-center\",\n        children: \"!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 7\n    }, this), isOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50 max-h-96 overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between p-4 border-b border-gray-200\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"text-lg font-semibold text-gray-900\",\n          children: \"Notifications\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-2\",\n          children: [!isRateLimited && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              fetchNotifications();\n              fetchUnreadCount();\n            },\n            disabled: loading,\n            className: \"p-1 text-gray-400 hover:text-gray-600 transition-colors\",\n            title: \"Refresh notifications\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"h-4 w-4\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 299,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 17\n          }, this), unreadCount > 0 && !isRateLimited && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: markAllAsRead,\n            className: \"text-sm text-blue-600 hover:text-blue-700 font-medium\",\n            children: \"Mark all read\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 11\n      }, this), isRateLimited && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 bg-yellow-50 border-b border-yellow-200\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-2 text-yellow-800\",\n          children: [/*#__PURE__*/_jsxDEV(ClockIcon, {\n            className: \"h-4 w-4\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 318,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm font-medium\",\n            children: \"Rate limited\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-xs text-yellow-600 mt-1\",\n          children: \"Too many requests. Notifications will resume automatically in a few minutes.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"max-h-80 overflow-y-auto\",\n        children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 text-center text-gray-500\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 331,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mt-2\",\n            children: \"Loading notifications...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 332,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 15\n        }, this) : notifications.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 text-center text-gray-500\",\n          children: [/*#__PURE__*/_jsxDEV(BellIcon, {\n            className: \"h-8 w-8 mx-auto mb-2 text-gray-300\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: !user ? 'Please login to see notifications' : isRateLimited ? 'Notifications temporarily unavailable' : error ? 'Unable to load notifications' : 'No notifications yet'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 17\n          }, this), error && !isRateLimited && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xs text-gray-400 mt-1\",\n            children: \"Check console for details\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 343,\n            columnNumber: 19\n          }, this), isRateLimited && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xs text-yellow-600 mt-1\",\n            children: \"Please wait a few minutes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"divide-y divide-gray-100\",\n          children: notifications.map(notification => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `p-4 hover:bg-blue-50 transition-colors cursor-pointer border-l-4 ${!notification.isRead ? 'bg-blue-50 border-l-blue-500' : 'border-l-transparent'} hover:border-l-blue-400`,\n            onClick: () => handleNotificationClick(notification),\n            title: `Click to view ${notification.type.toLowerCase().replace('_', ' ')}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-start gap-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex-shrink-0 mt-1\",\n                children: getNotificationIcon(notification.type)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 361,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex-1 min-w-0\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center gap-2 mb-1\",\n                  children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                    className: `text-sm font-medium ${!notification.isRead ? 'text-gray-900' : 'text-gray-700'}`,\n                    children: notification.title\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 366,\n                    columnNumber: 27\n                  }, this), !notification.isRead && /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-2 h-2 bg-blue-500 rounded-full\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 372,\n                    columnNumber: 29\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 365,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm text-gray-600 mb-2\",\n                  children: notification.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 375,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center gap-2 text-xs text-gray-400\",\n                  children: [/*#__PURE__*/_jsxDEV(ClockIcon, {\n                    className: \"h-3 w-3\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 379,\n                    columnNumber: 27\n                  }, this), formatTimeAgo(notification.createdAt), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-blue-500 font-medium\",\n                    children: \"Click to view \\u2192\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 381,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 378,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 364,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 360,\n              columnNumber: 21\n            }, this)\n          }, notification.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 19\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 11\n      }, this), notifications.length > 0 && !isRateLimited && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-3 border-t border-gray-200 bg-gray-50\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            setIsOpen(false);\n            navigate('/sent-proposals');\n          },\n          className: \"w-full text-sm text-blue-600 hover:text-blue-700 font-medium\",\n          children: \"View all proposals\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 9\n    }, this), isOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 z-40\",\n      onClick: () => setIsOpen(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 244,\n    columnNumber: 5\n  }, this);\n}\n_s(NotificationBell, \"hRKq9I1n8mKZi3AD16sox4vCEh4=\", false, function () {\n  return [useAuth, useNavigate];\n});\n_c = NotificationBell;\nvar _c;\n$RefreshReg$(_c, \"NotificationBell\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","BellIcon","ChatBubbleLeftIcon","EyeIcon","CheckCircleIcon","XCircleIcon","UserIcon","ClockIcon","notificationAPI","toast","useAuth","jsxDEV","_jsxDEV","NotificationBell","_s","user","navigate","notifications","setNotifications","unreadCount","setUnreadCount","isOpen","setIsOpen","loading","setLoading","error","setError","isRateLimited","setIsRateLimited","retryCount","setRetryCount","lastFetchTime","intervalRef","fetchNotifications","fetchUnreadCount","current","setInterval","now","Date","clearInterval","response","getAll","data","success","_error$response","_error$message","console","status","message","includes","backoffTime","Math","min","pow","setTimeout","prev","getUnreadCount","_error$response2","_error$message2","handleNotificationClick","notification","markAsRead","id","type","proposalId","notificationId","map","notif","isRead","max","markAllAsRead","getNotificationIcon","className","fileName","_jsxFileName","lineNumber","columnNumber","formatTimeAgo","dateString","date","diffInMinutes","floor","getTime","children","onClick","title","disabled","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","length","toLowerCase","replace","createdAt","_c","$RefreshReg$"],"sources":["/Users/davnishsingh/Documents/proposalai-main/proposalai/client/src/components/NotificationBell.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { \n  BellIcon, \n  ChatBubbleLeftIcon, \n  EyeIcon, \n  CheckCircleIcon, \n  XCircleIcon,\n  UserIcon,\n  ClockIcon\n} from '@heroicons/react/24/outline';\nimport { notificationAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { useAuth } from '../hooks/useAuth';\n\ninterface Notification {\n  id: string;\n  type: 'COMMENT' | 'PROPOSAL_OPENED' | 'PROPOSAL_APPROVED' | 'PROPOSAL_REJECTED' | 'CLIENT_REPLY' | 'ACCESS_REQUEST';\n  title: string;\n  message: string;\n  isRead: boolean;\n  createdAt: string;\n  proposalId?: string;\n  proposalTitle?: string;\n  clientName?: string;\n}\n\nexport default function NotificationBell() {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [isOpen, setIsOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(false);\n  \n  // Rate limiting and backoff state\n  const [isRateLimited, setIsRateLimited] = useState(false);\n  const [retryCount, setRetryCount] = useState(0);\n  const lastFetchTime = useRef<number>(0);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    if (user) {\n      fetchNotifications();\n      fetchUnreadCount();\n      \n      // Poll for new notifications every 2 minutes (120 seconds) instead of 30 seconds\n      intervalRef.current = setInterval(() => {\n        // Only fetch if not rate limited and enough time has passed\n        const now = Date.now();\n        if (!isRateLimited && (now - lastFetchTime.current) > 60000) { // 1 minute minimum between calls\n          fetchUnreadCount();\n          fetchNotifications(); // Also fetch the full notification list\n          lastFetchTime.current = now;\n        }\n      }, 120000); // 2 minutes\n\n      return () => {\n        if (intervalRef.current) {\n          clearInterval(intervalRef.current);\n        }\n      };\n    }\n  }, [user, isRateLimited]);\n\n  const fetchNotifications = async () => {\n    try {\n      setLoading(true);\n      setError(false);\n      setIsRateLimited(false);\n      setRetryCount(0);\n      \n      const response = await notificationAPI.getAll();\n      if (response.data.success) {\n        setNotifications(response.data.data);\n      }\n    } catch (error: any) {\n      console.error('Failed to fetch notifications:', error);\n      setError(true);\n      \n      // Handle rate limiting\n      if (error.response?.status === 429 || error.message?.includes('Too many requests')) {\n        setIsRateLimited(true);\n        // Exponential backoff: wait 2^retryCount minutes\n        const backoffTime = Math.min(Math.pow(2, retryCount) * 60000, 300000); // Max 5 minutes\n        setTimeout(() => {\n          setIsRateLimited(false);\n          setRetryCount(prev => prev + 1);\n        }, backoffTime);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchUnreadCount = async () => {\n    try {\n      // Skip if rate limited\n      if (isRateLimited) {\n        return;\n      }\n      \n      const response = await notificationAPI.getUnreadCount();\n      if (response.data.success) {\n        setUnreadCount(response.data.data.unreadCount);\n        setIsRateLimited(false);\n        setRetryCount(0);\n      }\n    } catch (error: any) {\n      console.error('Failed to fetch unread count:', error);\n      \n      // Handle rate limiting\n      if (error.response?.status === 429 || error.message?.includes('Too many requests')) {\n        setIsRateLimited(true);\n        // Exponential backoff: wait 2^retryCount minutes\n        const backoffTime = Math.min(Math.pow(2, retryCount) * 60000, 300000); // Max 5 minutes\n        setTimeout(() => {\n          setIsRateLimited(false);\n          setRetryCount(prev => prev + 1);\n        }, backoffTime);\n      }\n      // Don't set error here as we still want to show the bell\n    }\n  };\n\n  const handleNotificationClick = async (notification: Notification) => {\n    try {\n      // Mark as read first\n      await markAsRead(notification.id);\n      \n      // Close the dropdown\n      setIsOpen(false);\n      \n      // Navigate based on notification type\n      switch (notification.type) {\n        case 'COMMENT':\n        case 'CLIENT_REPLY':\n          if (notification.proposalId) {\n            // Navigate to proposal with comments tab\n            navigate(`/proposals/${notification.proposalId}/view?tab=comments`);\n            toast.success('Navigating to comments...');\n          } else {\n            navigate('/sent-proposals');\n            toast('Proposal not found, showing sent proposals');\n          }\n          break;\n          \n        case 'PROPOSAL_OPENED':\n        case 'PROPOSAL_APPROVED':\n        case 'PROPOSAL_REJECTED':\n          if (notification.proposalId) {\n            // Navigate to proposal view\n            navigate(`/proposals/${notification.proposalId}/view`);\n            toast.success('Navigating to proposal...');\n          } else {\n            navigate('/sent-proposals');\n            toast('Proposal not found, showing sent proposals');\n          }\n          break;\n          \n        case 'ACCESS_REQUEST':\n          if (notification.proposalId) {\n            // Navigate to proposal with activity tab\n            navigate(`/proposals/${notification.proposalId}/view?tab=activity`);\n            toast.success('Navigating to proposal activity...');\n          } else {\n            navigate('/sent-proposals');\n            toast('Proposal not found, showing sent proposals');\n          }\n          break;\n          \n        default:\n          // Fallback to sent proposals\n          navigate('/sent-proposals');\n          toast('Navigating to sent proposals');\n          break;\n      }\n    } catch (error) {\n      console.error('Failed to handle notification click:', error);\n      toast.error('Failed to navigate to notification. Please try again.');\n      // Still close the dropdown even if navigation fails\n      setIsOpen(false);\n    }\n  };\n\n  const markAsRead = async (notificationId: string) => {\n    try {\n      await notificationAPI.markAsRead(notificationId);\n      setNotifications(prev => \n        prev.map(notif => \n          notif.id === notificationId ? { ...notif, isRead: true } : notif\n        )\n      );\n      setUnreadCount(prev => Math.max(0, prev - 1));\n    } catch (error) {\n      console.error('Failed to mark notification as read:', error);\n    }\n  };\n\n  const markAllAsRead = async () => {\n    try {\n      await notificationAPI.markAllAsRead();\n      setNotifications(prev => prev.map(notif => ({ ...notif, isRead: true })));\n      setUnreadCount(0);\n      toast.success('All notifications marked as read');\n    } catch (error) {\n      console.error('Failed to mark all notifications as read:', error);\n      toast.error('Failed to mark notifications as read');\n    }\n  };\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case 'COMMENT':\n        return <ChatBubbleLeftIcon className=\"h-5 w-5 text-blue-500\" />;\n      case 'PROPOSAL_OPENED':\n        return <EyeIcon className=\"h-5 w-5 text-green-500\" />;\n      case 'PROPOSAL_APPROVED':\n        return <CheckCircleIcon className=\"h-5 w-5 text-green-600\" />;\n      case 'PROPOSAL_REJECTED':\n        return <XCircleIcon className=\"h-5 w-5 text-red-500\" />;\n      case 'CLIENT_REPLY':\n        return <UserIcon className=\"h-5 w-5 text-purple-500\" />;\n      case 'ACCESS_REQUEST':\n        return <UserIcon className=\"h-5 w-5 text-orange-500\" />;\n      default:\n        return <BellIcon className=\"h-5 w-5 text-gray-500\" />;\n    }\n  };\n\n  const formatTimeAgo = (dateString: string) => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diffInMinutes = Math.floor((now.getTime() - date.getTime()) / (1000 * 60));\n    \n    if (diffInMinutes < 1) return 'Just now';\n    if (diffInMinutes < 60) return `${diffInMinutes}m ago`;\n    if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;\n    return `${Math.floor(diffInMinutes / 1440)}d ago`;\n  };\n\n  return (\n    <div className=\"relative\">\n      {/* Notification Bell Button - Always show, even if API fails */}\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`relative p-2 rounded-lg transition-colors ${\n          isRateLimited \n            ? 'text-yellow-300 hover:text-yellow-200 hover:bg-yellow-900/20' \n            : 'text-white/80 hover:text-white hover:bg-white/10'\n        }`}\n        title={\n          isRateLimited \n            ? \"Rate limited - notifications temporarily unavailable\" \n            : user \n              ? \"Notifications\" \n              : \"Login to see notifications\"\n        }\n      >\n        <BellIcon className=\"h-6 w-6\" />\n        {user && unreadCount > 0 && !isRateLimited && (\n          <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium\">\n            {unreadCount > 99 ? '99+' : unreadCount}\n          </span>\n        )}\n        {/* Show rate limiting indicator */}\n        {isRateLimited && (\n          <span className=\"absolute -bottom-1 -right-1 bg-yellow-500 text-white text-xs rounded-full h-3 w-3 flex items-center justify-center\">\n            ⏱\n          </span>\n        )}\n        {/* Show error indicator */}\n        {error && !isRateLimited && (\n          <span className=\"absolute -bottom-1 -right-1 bg-yellow-400 text-white text-xs rounded-full h-3 w-3 flex items-center justify-center\">\n            !\n          </span>\n        )}\n      </button>\n\n      {/* Notification Dropdown */}\n      {isOpen && (\n        <div className=\"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50 max-h-96 overflow-hidden\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">Notifications</h3>\n            <div className=\"flex items-center gap-2\">\n              {!isRateLimited && (\n                <button\n                  onClick={() => {\n                    fetchNotifications();\n                    fetchUnreadCount();\n                  }}\n                  disabled={loading}\n                  className=\"p-1 text-gray-400 hover:text-gray-600 transition-colors\"\n                  title=\"Refresh notifications\"\n                >\n                  <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                  </svg>\n                </button>\n              )}\n              {unreadCount > 0 && !isRateLimited && (\n                <button\n                  onClick={markAllAsRead}\n                  className=\"text-sm text-blue-600 hover:text-blue-700 font-medium\"\n                >\n                  Mark all read\n                </button>\n              )}\n            </div>\n          </div>\n\n          {/* Rate Limiting Message */}\n          {isRateLimited && (\n            <div className=\"p-4 bg-yellow-50 border-b border-yellow-200\">\n              <div className=\"flex items-center gap-2 text-yellow-800\">\n                <ClockIcon className=\"h-4 w-4\" />\n                <p className=\"text-sm font-medium\">Rate limited</p>\n              </div>\n              <p className=\"text-xs text-yellow-600 mt-1\">\n                Too many requests. Notifications will resume automatically in a few minutes.\n              </p>\n            </div>\n          )}\n\n          {/* Notifications List */}\n          <div className=\"max-h-80 overflow-y-auto\">\n            {loading ? (\n              <div className=\"p-4 text-center text-gray-500\">\n                <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto\"></div>\n                <p className=\"mt-2\">Loading notifications...</p>\n              </div>\n            ) : notifications.length === 0 ? (\n              <div className=\"p-4 text-center text-gray-500\">\n                <BellIcon className=\"h-8 w-8 mx-auto mb-2 text-gray-300\" />\n                <p>\n                  {!user ? 'Please login to see notifications' : \n                   isRateLimited ? 'Notifications temporarily unavailable' :\n                   error ? 'Unable to load notifications' : 'No notifications yet'}\n                </p>\n                {error && !isRateLimited && (\n                  <p className=\"text-xs text-gray-400 mt-1\">Check console for details</p>\n                )}\n                {isRateLimited && (\n                  <p className=\"text-xs text-yellow-600 mt-1\">Please wait a few minutes</p>\n                )}\n              </div>\n            ) : (\n              <div className=\"divide-y divide-gray-100\">\n                {notifications.map((notification) => (\n                  <div\n                    key={notification.id}\n                    className={`p-4 hover:bg-blue-50 transition-colors cursor-pointer border-l-4 ${\n                      !notification.isRead ? 'bg-blue-50 border-l-blue-500' : 'border-l-transparent'\n                    } hover:border-l-blue-400`}\n                    onClick={() => handleNotificationClick(notification)}\n                    title={`Click to view ${notification.type.toLowerCase().replace('_', ' ')}`}\n                  >\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"flex-shrink-0 mt-1\">\n                        {getNotificationIcon(notification.type)}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <p className={`text-sm font-medium ${\n                            !notification.isRead ? 'text-gray-900' : 'text-gray-700'\n                          }`}>\n                            {notification.title}\n                          </p>\n                          {!notification.isRead && (\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n                          )}\n                        </div>\n                        <p className=\"text-sm text-gray-600 mb-2\">\n                          {notification.message}\n                        </p>\n                        <div className=\"flex items-center gap-2 text-xs text-gray-400\">\n                          <ClockIcon className=\"h-3 w-3\" />\n                          {formatTimeAgo(notification.createdAt)}\n                          <span className=\"text-blue-500 font-medium\">Click to view →</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          {notifications.length > 0 && !isRateLimited && (\n            <div className=\"p-3 border-t border-gray-200 bg-gray-50\">\n              <button\n                onClick={() => {\n                  setIsOpen(false);\n                  navigate('/sent-proposals');\n                }}\n                className=\"w-full text-sm text-blue-600 hover:text-blue-700 font-medium\"\n              >\n                View all proposals\n              </button>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Backdrop */}\n      {isOpen && (\n        <div\n          className=\"fixed inset-0 z-40\"\n          onClick={() => setIsOpen(false)}\n        />\n      )}\n    </div>\n  );\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}