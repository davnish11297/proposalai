{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{toast}from'react-hot-toast';import{proposalsAPI,getOpenRouterChatCompletion}from'../services/api';import ClientSelectionModal from'../components/ClientSelectionModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProposalEditor=()=>{var _proposal$content8,_proposal$content9,_proposal$metadata3,_proposal$content0,_proposal$content1,_proposal$content1$fu,_proposal$content10,_proposal$content10$f;const{id}=useParams();const navigate=useNavigate();const[loading,setLoading]=useState(false);const[generating,setGenerating]=useState(false);const[showClientModal,setShowClientModal]=useState(false);const[selectedClientId,setSelectedClientId]=useState(undefined);const[proposal,setProposal]=useState({title:'',description:'',clientName:'',clientEmail:'',type:'PROPOSAL',content:{executiveSummary:'',approach:'',budgetDetails:'',timeline:'',budget:'',fullProposal:''// Added for unified editing\n},metadata:{industry:'',companySize:'',projectScope:''}});const[accessRequests,setAccessRequests]=useState([]);const[grantingRequestId,setGrantingRequestId]=useState(null);const isNewProposal=!id;// Debug log to verify access requests\nconsole.log('🔍 Access requests state:',accessRequests);useEffect(()=>{const fetchProposal=async()=>{try{const{data}=await proposalsAPI.getById(id);// Ensure metadata exists with default values\nconst proposalData={...data.data,metadata:{industry:'',companySize:'',projectScope:'',...data.data.metadata},content:{executiveSummary:'',approach:'',budgetDetails:'',timeline:'',budget:'',fullProposal:'',...data.data.content}};setProposal(proposalData);setSelectedClientId(data.data.clientId);}catch(error){console.error('Failed to fetch proposal:',error);toast.error('Failed to load proposal');}};if(id){fetchProposal();}},[id]);useEffect(()=>{if(id){proposalsAPI.getAccessRequests(id).then(_ref=>{let{data}=_ref;return setAccessRequests(data.data);}).catch(()=>setAccessRequests([]));}},[id]);const handleGenerateWithAI=async()=>{// Validate required fields\nconsole.log('🔍 Current proposal state:',{clientName:proposal.clientName,description:proposal.description,hasClientName:!!proposal.clientName,hasDescription:!!proposal.description});if(!proposal.clientName||!proposal.description){const missingFields=[];if(!proposal.clientName)missingFields.push('Client Name');if(!proposal.description)missingFields.push('Description');toast.error(`Please fill in: ${missingFields.join(' and ')} before generating content`);return;}try{var _proposal$metadata,_proposal$metadata2,_proposal$content,_proposal$content2,_result$choices,_result$choices$,_result$choices$$mess,_execMatch$,_approachMatch$,_budgetMatch$,_timelineMatch$;setGenerating(true);// Compose prompt for OpenRouter\nconst messages=[{role:'system',content:`You are an expert proposal writer. Generate a detailed, professional proposal for the following client and project. Structure your response with clear sections: Executive Summary, Approach, Budget Details, and Timeline. Use clear, persuasive language and make each section comprehensive.`},{role:'user',content:`Client Name: ${proposal.clientName}\\nIndustry: ${((_proposal$metadata=proposal.metadata)===null||_proposal$metadata===void 0?void 0:_proposal$metadata.industry)||''}\\nCompany Size: ${((_proposal$metadata2=proposal.metadata)===null||_proposal$metadata2===void 0?void 0:_proposal$metadata2.companySize)||''}\\nProject Description: ${proposal.description}\\nBudget: ${((_proposal$content=proposal.content)===null||_proposal$content===void 0?void 0:_proposal$content.budget)||''}\\nTimeline: ${((_proposal$content2=proposal.content)===null||_proposal$content2===void 0?void 0:_proposal$content2.timeline)||''}\\n\\nPlease provide a professional proposal with the following sections:\\n1. Executive Summary\\n2. Approach\\n3. Budget Details\\n4. Timeline`}];console.log('🚀 Sending AI generation request with messages:',messages);const result=await getOpenRouterChatCompletion(messages);console.log('✅ AI response received:',result);const aiContent=((_result$choices=result.choices)===null||_result$choices===void 0?void 0:(_result$choices$=_result$choices[0])===null||_result$choices$===void 0?void 0:(_result$choices$$mess=_result$choices$.message)===null||_result$choices$$mess===void 0?void 0:_result$choices$$mess.content)||'';console.log('📝 AI generated content:',aiContent);// Parse the AI response into sections\nconsole.log('�� Raw AI response:',aiContent);// Improved parsing with better regex patterns\nlet executiveSummary='',approach='',budgetDetails='',timeline='';// More flexible regex patterns that handle various formats\nconst execMatch=aiContent.match(/(?:Executive Summary|EXECUTIVE SUMMARY)[:\\s\\n]*([\\s\\S]*?)(?=\\n\\s*(?:Approach|APPROACH|Budget|BUDGET|Timeline|TIMELINE|Next Steps|NEXT STEPS)[:\\s\\n]|$)/i);const approachMatch=aiContent.match(/(?:Approach|APPROACH|Methodology|METHODOLOGY)[:\\s\\n]*([\\s\\S]*?)(?=\\n\\s*(?:Budget|BUDGET|Timeline|TIMELINE|Next Steps|NEXT STEPS)[:\\s\\n]|$)/i);const budgetMatch=aiContent.match(/(?:Budget Details?|BUDGET DETAILS?|Budget|BUDGET)[:\\s\\n]*([\\s\\S]*?)(?=\\n\\s*(?:Timeline|TIMELINE|Next Steps|NEXT STEPS)[:\\s\\n]|$)/i);const timelineMatch=aiContent.match(/(?:Timeline|TIMELINE|Schedule|SCHEDULE)[:\\s\\n]*([\\s\\S]*?)(?=\\n\\s*(?:Next Steps|NEXT STEPS|Conclusion|CONCLUSION)[:\\s\\n]|$)/i);executiveSummary=(execMatch===null||execMatch===void 0?void 0:(_execMatch$=execMatch[1])===null||_execMatch$===void 0?void 0:_execMatch$.trim())||'';approach=(approachMatch===null||approachMatch===void 0?void 0:(_approachMatch$=approachMatch[1])===null||_approachMatch$===void 0?void 0:_approachMatch$.trim())||'';budgetDetails=(budgetMatch===null||budgetMatch===void 0?void 0:(_budgetMatch$=budgetMatch[1])===null||_budgetMatch$===void 0?void 0:_budgetMatch$.trim())||'';timeline=(timelineMatch===null||timelineMatch===void 0?void 0:(_timelineMatch$=timelineMatch[1])===null||_timelineMatch$===void 0?void 0:_timelineMatch$.trim())||'';// If regex parsing didn't work well, try alternative parsing\nif(!executiveSummary&&!approach&&!budgetDetails&&!timeline){console.log('⚠️ Primary regex parsing failed, trying alternative parsing');// Split by numbered sections or headers\nconst sections=aiContent.split(/\\n\\s*(?:\\d+\\.\\s*)?(?:Executive Summary|Approach|Budget|Timeline|Methodology|Schedule)/i);if(sections.length>1){var _sections$,_sections$2,_sections$3,_sections$4;executiveSummary=((_sections$=sections[1])===null||_sections$===void 0?void 0:_sections$.trim())||'';approach=((_sections$2=sections[2])===null||_sections$2===void 0?void 0:_sections$2.trim())||'';budgetDetails=((_sections$3=sections[3])===null||_sections$3===void 0?void 0:_sections$3.trim())||'';timeline=((_sections$4=sections[4])===null||_sections$4===void 0?void 0:_sections$4.trim())||'';}else{// Last resort: use the full content as executive summary\nconsole.log('⚠️ Alternative parsing failed, using full content as executive summary');executiveSummary=aiContent;}}// Clean up the content by removing extra whitespace and formatting\nconst cleanContent=content=>{return content.replace(/\\n\\s*\\n\\s*\\n/g,'\\n\\n')// Remove excessive line breaks\n.replace(/^\\s+|\\s+$/g,'')// Trim whitespace\n.replace(/\\*\\*(.*?)\\*\\*/g,'$1')// Remove bold formatting\n.replace(/\\*(.*?)\\*/g,'$1');// Remove italic formatting\n};executiveSummary=cleanContent(executiveSummary);approach=cleanContent(approach);budgetDetails=cleanContent(budgetDetails);timeline=cleanContent(timeline);console.log('📋 Parsed sections:',{executiveSummary:executiveSummary.substring(0,150)+(executiveSummary.length>150?'...':''),approach:approach.substring(0,150)+(approach.length>150?'...':''),budgetDetails:budgetDetails.substring(0,150)+(budgetDetails.length>150?'...':''),timeline:timeline.substring(0,150)+(timeline.length>150?'...':'')});setProposal({...proposal,content:{...proposal.content,executiveSummary,approach,budgetDetails,timeline}});toast.success('Proposal content generated successfully!');}catch(error){console.error('❌ Content generation error:',error);console.error('❌ Error details:',{message:error.message,stack:error.stack,response:error.response});toast.error(error.message||'Failed to generate proposal content');}finally{setGenerating(false);}};const handleSave=async()=>{try{setLoading(true);const proposalData={...proposal// teamId: selectedTeamId, // teamId is not used\n};if(isNewProposal){// Create new proposal\nawait proposalsAPI.create(proposalData);toast.success('Proposal created successfully!');navigate('/proposals');}else{// Update existing proposal\nawait proposalsAPI.update(id,proposalData);toast.success('Proposal updated successfully!');}navigate('/proposals');}catch(error){var _error$response,_error$response$data;console.error('Save error:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Failed to save proposal');}finally{setLoading(false);}};const handleSubmit=async()=>{try{setLoading(true);const proposalData={...proposal,// teamId: selectedTeamId, // teamId is not used\nstatus:'IN_REVIEW'};if(isNewProposal){// Create and submit new proposal\nawait proposalsAPI.create(proposalData);toast.success('Proposal submitted successfully!');navigate('/proposals');}else{// Update and submit existing proposal\nawait proposalsAPI.update(id,proposalData);toast.success('Proposal submitted successfully!');navigate('/proposals');}}catch(error){var _error$response2,_error$response2$data;console.error('Submit error:',error);toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Failed to submit proposal');}finally{setLoading(false);}};const handleClientSelect=client=>{setProposal({...proposal,clientName:client.name,clientEmail:client.email||''});setSelectedClientId(client.id);toast.success(`Selected client: ${client.name}`);};const handleClearClient=()=>{setProposal({...proposal,clientName:'',clientEmail:''});setSelectedClientId(undefined);toast.success('Client selection cleared');};const handleGrantAccess=async requestId=>{setGrantingRequestId(requestId);try{await proposalsAPI.grantAccessRequest(id,requestId);toast.success('Access granted and email sent!');// Refresh access requests\nconst{data}=await proposalsAPI.getAccessRequests(id);setAccessRequests(data.data);}catch(error){toast.error('Failed to grant access');}finally{setGrantingRequestId(null);}};// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst handleRefineEntireProposal=async()=>{try{var _result$choices2,_result$choices2$,_result$choices2$$mes;setGenerating(true);const messages=[{role:'system',content:`You are an expert proposal writer. Refine the entire proposal content. Make it more detailed, persuasive, and comprehensive.`},{role:'user',content:`Current Proposal Content:\\n\\n${proposal.content.fullProposal||getCombinedProposalContent()}`}];const result=await getOpenRouterChatCompletion(messages);const refinedContent=((_result$choices2=result.choices)===null||_result$choices2===void 0?void 0:(_result$choices2$=_result$choices2[0])===null||_result$choices2$===void 0?void 0:(_result$choices2$$mes=_result$choices2$.message)===null||_result$choices2$$mes===void 0?void 0:_result$choices2$$mes.content)||'';setProposal({...proposal,content:{...proposal.content,fullProposal:refinedContent}});toast.success('Entire proposal refined successfully!');}catch(error){console.error('❌ Refine entire proposal error:',error);toast.error(error.message||'Failed to refine entire proposal');}finally{setGenerating(false);}};const handleFormatProposal=()=>{const content=proposal.content.fullProposal||getCombinedProposalContent();let formattedContent='';// Split content into sections\nconst sections=content.split(/^(#+)\\s*(.*)$/m);let i=0;while(i<sections.length){var _sections$i$match;const level=((_sections$i$match=sections[i].match(/^#+/))===null||_sections$i$match===void 0?void 0:_sections$i$match[0].length)||0;const title=sections[i+1];const text=sections[i+2];if(level===1){formattedContent+=`# ${title}\\n\\n${text}\\n\\n`;}else if(level===2){formattedContent+=`## ${title}\\n\\n${text}\\n\\n`;}else if(level===3){formattedContent+=`### ${title}\\n\\n${text}\\n\\n`;}else{formattedContent+=`${text}\\n\\n`;// For paragraphs or other text\n}i+=3;// Move to the next section\n}setProposal({...proposal,content:{...proposal.content,fullProposal:formattedContent.trim()}});toast.success('Proposal content formatted!');};const getCombinedProposalContent=()=>{var _proposal$content3,_proposal$content4,_proposal$content5,_proposal$content6,_proposal$content7;return`${(proposal===null||proposal===void 0?void 0:(_proposal$content3=proposal.content)===null||_proposal$content3===void 0?void 0:_proposal$content3.executiveSummary)||''}\\n\\n# Approach\\n\\n${(proposal===null||proposal===void 0?void 0:(_proposal$content4=proposal.content)===null||_proposal$content4===void 0?void 0:_proposal$content4.approach)||''}\\n\\n# Budget Details\\n\\n${(proposal===null||proposal===void 0?void 0:(_proposal$content5=proposal.content)===null||_proposal$content5===void 0?void 0:_proposal$content5.budgetDetails)||''}\\n\\n# Timeline\\n\\n${(proposal===null||proposal===void 0?void 0:(_proposal$content6=proposal.content)===null||_proposal$content6===void 0?void 0:_proposal$content6.timeline)||''}\\n\\n# Additional Sections\\n\\n${(proposal===null||proposal===void 0?void 0:(_proposal$content7=proposal.content)===null||_proposal$content7===void 0?void 0:_proposal$content7.additionalSections)||''}`;};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-20 w-20 border-b-4 border-blue-600\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-1 min-h-0\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"w-[380px] min-w-[380px] max-w-[380px] bg-white border-r border-gray-200 flex flex-col p-8\",children:[accessRequests.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold mb-2 text-blue-700\",children:\"Access Requests\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-4\",children:accessRequests.map(req=>/*#__PURE__*/_jsxs(\"li\",{className:\"bg-blue-50 rounded-lg p-4 flex flex-col md:flex-row md:items-center md:justify-between border border-blue-100\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-semibold text-blue-900\",children:[req.name,\" (\",req.email,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-700\",children:req.company}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:req.reason}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400 mt-1\",children:[\"Requested: \",new Date(req.createdAt).toLocaleString()]}),req.status==='GRANTED'&&req.accessCode&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-green-700 text-xs mt-1\",children:[\"Granted: \",req.accessCode]})]}),req.status==='PENDING'&&/*#__PURE__*/_jsx(\"button\",{className:\"mt-2 md:mt-0 px-4 py-2 bg-gradient-to-r from-blue-600 to-green-500 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-green-600 transition disabled:opacity-50\",disabled:grantingRequestId===req.id,onClick:()=>handleGrantAccess(req.id),children:grantingRequestId===req.id?'Granting...':'Grant Access'}),req.status==='GRANTED'&&/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-green-600 font-semibold\",children:\"Granted\"}),req.status==='DENIED'&&/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-red-600 font-semibold\",children:\"Denied\"})]},req.id))})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-8\",children:isNewProposal?'Create New Proposal':'Edit Proposal'}),/*#__PURE__*/_jsxs(\"form\",{className:\"space-y-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:[\"Proposal Title \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:(proposal===null||proposal===void 0?void 0:proposal.title)||'',onChange:e=>setProposal({...proposal,title:e.target.value}),className:\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\",placeholder:\"Enter proposal title\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:[\"Client Name \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:(proposal===null||proposal===void 0?void 0:proposal.clientName)||'',onChange:e=>setProposal({...proposal,clientName:e.target.value}),className:\"flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\",placeholder:\"Enter client name\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>setShowClientModal(true),className:`px-6 py-3 rounded-xl transition-all duration-200 flex items-center gap-2 whitespace-nowrap font-medium ${selectedClientId?'bg-green-600 text-white hover:bg-green-700 shadow-md':'bg-blue-600 text-white hover:bg-blue-700 shadow-md'}`,children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"})}),selectedClientId?'Change':'Select']})]}),selectedClientId&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 p-2 bg-green-50 border border-green-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-sm text-green-800\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M5 13l4 4L19 7\"})}),\"Client selected from database\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleClearClient,className:\"text-red-600 hover:text-red-800 text-sm font-medium\",children:\"Clear\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:[\"Description \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsx(\"textarea\",{value:(proposal===null||proposal===void 0?void 0:proposal.description)||'',onChange:e=>setProposal({...proposal,description:e.target.value}),rows:6,className:\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200\",placeholder:\"Describe the project, requirements, and objectives...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:\"Budget\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:(proposal===null||proposal===void 0?void 0:(_proposal$content8=proposal.content)===null||_proposal$content8===void 0?void 0:_proposal$content8.budget)||'',onChange:e=>setProposal({...proposal,content:{...(proposal===null||proposal===void 0?void 0:proposal.content),budget:e.target.value}}),className:\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\",placeholder:\"e.g., $50,000\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:\"Timeline\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:(proposal===null||proposal===void 0?void 0:(_proposal$content9=proposal.content)===null||_proposal$content9===void 0?void 0:_proposal$content9.timeline)||'',onChange:e=>setProposal({...proposal,content:{...(proposal===null||proposal===void 0?void 0:proposal.content),timeline:e.target.value}}),className:\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\",placeholder:\"e.g., 3 months\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold text-gray-700 mb-3\",children:\"Industry\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:(proposal===null||proposal===void 0?void 0:(_proposal$metadata3=proposal.metadata)===null||_proposal$metadata3===void 0?void 0:_proposal$metadata3.industry)||'',onChange:e=>setProposal({...proposal,metadata:{...(proposal===null||proposal===void 0?void 0:proposal.metadata),industry:e.target.value}}),className:\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\",placeholder:\"e.g., Technology, Healthcare, Finance\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 pt-6\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleSave,disabled:loading,className:\"flex-1 px-4 py-3 bg-gray-600 text-white font-medium rounded-xl hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 transition-all duration-200\",children:\"Save Draft\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleSubmit,disabled:loading,className:\"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 transition-all duration-300 transform hover:scale-105\",children:\"Submit Proposal\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleGenerateWithAI,disabled:generating||loading||!(proposal!==null&&proposal!==void 0&&proposal.clientName)||!(proposal!==null&&proposal!==void 0&&proposal.description),className:`w-full mt-8 py-4 px-6 rounded-xl font-semibold text-white transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 shadow-lg ${generating||loading||!(proposal!==null&&proposal!==void 0&&proposal.clientName)||!(proposal!==null&&proposal!==void 0&&proposal.description)?'bg-gray-400 cursor-not-allowed':'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 focus:ring-blue-500'}`,children:generating?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\",xmlns:\"http://www.w3.org/2000/svg\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]}),\"Generating Content...\"]}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 10V3L4 14h7v7l9-11h-7z\"})}),\"Generate AI Content\"]})}),(!(proposal!==null&&proposal!==void 0&&proposal.clientName)||!(proposal!==null&&proposal!==void 0&&proposal.description))&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 text-center mt-2\",children:\"Enter client name and description to enable AI generation\"})]})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"flex-1 flex flex-col p-12 overflow-y-auto bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-3xl font-bold text-gray-900 mb-2\",children:\"Proposal Content\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Review, edit, and refine your proposal content\"})]}),(accessRequests.length>0||isNewProposal)&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8 bg-white rounded-xl shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold mb-4 text-blue-700 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"})}),\"Access Requests (\",accessRequests.length>0?accessRequests.length:1,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:accessRequests.length>0?accessRequests.map(req=>/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-50 rounded-lg p-4 border border-blue-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-semibold text-blue-900\",children:[req.name,\" (\",req.email,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-700\",children:req.company}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 mt-1\",children:req.reason}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400 mt-1\",children:[\"Requested: \",new Date(req.createdAt).toLocaleString()]}),req.status==='GRANTED'&&req.accessCode&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-green-700 text-xs mt-1 font-medium\",children:[\"Access Code: \",req.accessCode]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[req.status==='PENDING'&&/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-gradient-to-r from-blue-600 to-green-500 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-green-600 transition disabled:opacity-50 text-sm\",disabled:grantingRequestId===req.id,onClick:()=>handleGrantAccess(req.id),children:grantingRequestId===req.id?'Granting...':'Grant Access'}),req.status==='GRANTED'&&/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600 font-semibold text-sm\",children:\"\\u2713 Granted\"}),req.status==='DENIED'&&/*#__PURE__*/_jsx(\"span\",{className:\"text-red-600 font-semibold text-sm\",children:\"\\u2717 Denied\"})]})]})},req.id)):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-medium mb-2\",children:\"No Access Requests\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm\",children:\"When clients request access to this proposal, they will appear here.\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-[700px] min-h-[300px] flex-1 overflow-y-auto pr-2\",children:generating?/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center py-12\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 animate-ping\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full opacity-20\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 animate-ping\",style:{animationDelay:'0.5s'},children:/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 bg-gradient-to-r from-green-400 to-blue-500 rounded-full opacity-20\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-8 h-8 text-white animate-spin\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 10V3L4 14h7v7l9-11h-7z\"})})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-center\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-2\",children:\"Generating Your Proposal\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Our AI is crafting a professional proposal tailored to your needs...\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center mt-4 space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\",style:{animationDelay:'0.1s'}}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\",style:{animationDelay:'0.2s'}})]})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold text-gray-900 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-blue-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"})}),\"Proposal Content Editor\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleRefineEntireProposal(),className:\"px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 10V3L4 14h7v7l9-11h-7z\"})}),\"Refine with AI\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleFormatProposal(),className:\"px-4 py-2 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700 transition flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M4 6h16M4 12h16M4 18h16\"})}),\"Format\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 text-sm text-gray-600 mb-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"})}),\"Edit the entire proposal content below\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 10V3L4 14h7v7l9-11h-7z\"})}),\"Use \\\"Refine with AI\\\" to improve the entire document\"]})]})}),/*#__PURE__*/_jsx(\"textarea\",{value:(proposal===null||proposal===void 0?void 0:(_proposal$content0=proposal.content)===null||_proposal$content0===void 0?void 0:_proposal$content0.fullProposal)||getCombinedProposalContent(),onChange:e=>setProposal({...proposal,content:{...(proposal===null||proposal===void 0?void 0:proposal.content),fullProposal:e.target.value}}),rows:25,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200 bg-gray-50 font-mono text-sm leading-relaxed\",placeholder:\"Enter your complete proposal content here... # Executive Summary\\n[Your executive summary goes here] # Approach\\n[Your approach and methodology] # Budget Details\\n[Detailed budget breakdown] # Timeline\\n[Project timeline and milestones] # Additional Sections\\n[Any other relevant sections]\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex items-center justify-between text-xs text-gray-500\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Word count: \",(proposal===null||proposal===void 0?void 0:(_proposal$content1=proposal.content)===null||_proposal$content1===void 0?void 0:(_proposal$content1$fu=_proposal$content1.fullProposal)===null||_proposal$content1$fu===void 0?void 0:_proposal$content1$fu.split(/\\s+/).length)||0,\" words\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Characters: \",(proposal===null||proposal===void 0?void 0:(_proposal$content10=proposal.content)===null||_proposal$content10===void 0?void 0:(_proposal$content10$f=_proposal$content10.fullProposal)===null||_proposal$content10$f===void 0?void 0:_proposal$content10$f.length)||0]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 border border-green-200 rounded-lg p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-green-800\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M5 13l4 4L19 7\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Content Generated Successfully!\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-green-700 text-sm mt-1\",children:\"Review and edit the content above. Use \\\"Refine with AI\\\" to improve the entire document or \\\"Format\\\" to structure it properly.\"})]})]})})]})]}),/*#__PURE__*/_jsx(ClientSelectionModal,{isOpen:showClientModal,onClose:()=>setShowClientModal(false),onSelectClient:handleClientSelect,selectedClientId:selectedClientId})]});};export default ProposalEditor;","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","toast","proposalsAPI","getOpenRouterChatCompletion","ClientSelectionModal","jsx","_jsx","jsxs","_jsxs","ProposalEditor","_proposal$content8","_proposal$content9","_proposal$metadata3","_proposal$content0","_proposal$content1","_proposal$content1$fu","_proposal$content10","_proposal$content10$f","id","navigate","loading","setLoading","generating","setGenerating","showClientModal","setShowClientModal","selectedClientId","setSelectedClientId","undefined","proposal","setProposal","title","description","clientName","clientEmail","type","content","executiveSummary","approach","budgetDetails","timeline","budget","fullProposal","metadata","industry","companySize","projectScope","accessRequests","setAccessRequests","grantingRequestId","setGrantingRequestId","isNewProposal","console","log","fetchProposal","data","getById","proposalData","clientId","error","getAccessRequests","then","_ref","catch","handleGenerateWithAI","hasClientName","hasDescription","missingFields","push","join","_proposal$metadata","_proposal$metadata2","_proposal$content","_proposal$content2","_result$choices","_result$choices$","_result$choices$$mess","_execMatch$","_approachMatch$","_budgetMatch$","_timelineMatch$","messages","role","result","aiContent","choices","message","execMatch","match","approachMatch","budgetMatch","timelineMatch","trim","sections","split","length","_sections$","_sections$2","_sections$3","_sections$4","cleanContent","replace","substring","success","stack","response","handleSave","create","update","_error$response","_error$response$data","handleSubmit","status","_error$response2","_error$response2$data","handleClientSelect","client","name","email","handleClearClient","handleGrantAccess","requestId","grantAccessRequest","handleRefineEntireProposal","_result$choices2","_result$choices2$","_result$choices2$$mes","getCombinedProposalContent","refinedContent","handleFormatProposal","formattedContent","i","_sections$i$match","level","text","_proposal$content3","_proposal$content4","_proposal$content5","_proposal$content6","_proposal$content7","additionalSections","className","children","map","req","company","reason","Date","createdAt","toLocaleString","accessCode","disabled","onClick","value","onChange","e","target","placeholder","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","rows","xmlns","cx","cy","r","style","animationDelay","isOpen","onClose","onSelectClient"],"sources":["/Users/davnishsingh/Documents/proposalai-main/proposalai/client/src/pages/ProposalEditor.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { toast } from 'react-hot-toast';\nimport { proposalsAPI, getOpenRouterChatCompletion } from '../services/api';\nimport ClientSelectionModal from '../components/ClientSelectionModal';\n\nconst ProposalEditor: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(false);\n  const [generating, setGenerating] = useState(false);\n  const [showClientModal, setShowClientModal] = useState(false);\n  const [selectedClientId, setSelectedClientId] = useState<string | undefined>(undefined);\n  const [proposal, setProposal] = useState<any>({\n    title: '',\n    description: '',\n    clientName: '',\n    clientEmail: '',\n    type: 'PROPOSAL',\n    content: {\n      executiveSummary: '',\n      approach: '',\n      budgetDetails: '',\n      timeline: '',\n      budget: '',\n      fullProposal: '' // Added for unified editing\n    },\n    metadata: {\n      industry: '',\n      companySize: '',\n      projectScope: ''\n    }\n  });\n  const [accessRequests, setAccessRequests] = useState<any[]>([]);\n  const [grantingRequestId, setGrantingRequestId] = useState<string | null>(null);\n\n  const isNewProposal = !id;\n\n  // Debug log to verify access requests\n  console.log('🔍 Access requests state:', accessRequests);\n\n  useEffect(() => {\n    const fetchProposal = async () => {\n      try {\n        const { data } = await proposalsAPI.getById(id!);\n        // Ensure metadata exists with default values\n        const proposalData = {\n          ...data.data,\n          metadata: {\n            industry: '',\n            companySize: '',\n            projectScope: '',\n            ...data.data.metadata\n          },\n          content: {\n            executiveSummary: '',\n            approach: '',\n            budgetDetails: '',\n            timeline: '',\n            budget: '',\n            fullProposal: '',\n            ...data.data.content\n          }\n        };\n        setProposal(proposalData);\n        setSelectedClientId(data.data.clientId);\n      } catch (error) {\n        console.error('Failed to fetch proposal:', error);\n        toast.error('Failed to load proposal');\n      }\n    };\n\n    if (id) {\n      fetchProposal();\n    }\n  }, [id]);\n\n  useEffect(() => {\n    if (id) {\n      proposalsAPI.getAccessRequests(id)\n        .then(({ data }) => setAccessRequests(data.data))\n        .catch(() => setAccessRequests([]));\n    }\n  }, [id]);\n\n  const handleGenerateWithAI = async () => {\n    // Validate required fields\n    console.log('🔍 Current proposal state:', {\n      clientName: proposal.clientName,\n      description: proposal.description,\n      hasClientName: !!proposal.clientName,\n      hasDescription: !!proposal.description\n    });\n    \n    if (!proposal.clientName || !proposal.description) {\n      const missingFields = [];\n      if (!proposal.clientName) missingFields.push('Client Name');\n      if (!proposal.description) missingFields.push('Description');\n      toast.error(`Please fill in: ${missingFields.join(' and ')} before generating content`);\n      return;\n    }\n\n    try {\n      setGenerating(true);\n      \n      // Compose prompt for OpenRouter\n      const messages = [\n        {\n          role: 'system',\n          content: `You are an expert proposal writer. Generate a detailed, professional proposal for the following client and project. Structure your response with clear sections: Executive Summary, Approach, Budget Details, and Timeline. Use clear, persuasive language and make each section comprehensive.`,\n        },\n        {\n          role: 'user',\n          content: `Client Name: ${proposal.clientName}\\nIndustry: ${proposal.metadata?.industry || ''}\\nCompany Size: ${proposal.metadata?.companySize || ''}\\nProject Description: ${proposal.description}\\nBudget: ${proposal.content?.budget || ''}\\nTimeline: ${proposal.content?.timeline || ''}\\n\\nPlease provide a professional proposal with the following sections:\\n1. Executive Summary\\n2. Approach\\n3. Budget Details\\n4. Timeline`,\n        },\n      ];\n      \n      console.log('🚀 Sending AI generation request with messages:', messages);\n      \n      const result = await getOpenRouterChatCompletion(messages);\n      console.log('✅ AI response received:', result);\n      \n      const aiContent = result.choices?.[0]?.message?.content || '';\n      console.log('📝 AI generated content:', aiContent);\n      \n      // Parse the AI response into sections\n      console.log('�� Raw AI response:', aiContent);\n      \n      // Improved parsing with better regex patterns\n      let executiveSummary = '', approach = '', budgetDetails = '', timeline = '';\n      \n      // More flexible regex patterns that handle various formats\n      const execMatch = aiContent.match(/(?:Executive Summary|EXECUTIVE SUMMARY)[:\\s\\n]*([\\s\\S]*?)(?=\\n\\s*(?:Approach|APPROACH|Budget|BUDGET|Timeline|TIMELINE|Next Steps|NEXT STEPS)[:\\s\\n]|$)/i);\n      const approachMatch = aiContent.match(/(?:Approach|APPROACH|Methodology|METHODOLOGY)[:\\s\\n]*([\\s\\S]*?)(?=\\n\\s*(?:Budget|BUDGET|Timeline|TIMELINE|Next Steps|NEXT STEPS)[:\\s\\n]|$)/i);\n      const budgetMatch = aiContent.match(/(?:Budget Details?|BUDGET DETAILS?|Budget|BUDGET)[:\\s\\n]*([\\s\\S]*?)(?=\\n\\s*(?:Timeline|TIMELINE|Next Steps|NEXT STEPS)[:\\s\\n]|$)/i);\n      const timelineMatch = aiContent.match(/(?:Timeline|TIMELINE|Schedule|SCHEDULE)[:\\s\\n]*([\\s\\S]*?)(?=\\n\\s*(?:Next Steps|NEXT STEPS|Conclusion|CONCLUSION)[:\\s\\n]|$)/i);\n      \n      executiveSummary = execMatch?.[1]?.trim() || '';\n      approach = approachMatch?.[1]?.trim() || '';\n      budgetDetails = budgetMatch?.[1]?.trim() || '';\n      timeline = timelineMatch?.[1]?.trim() || '';\n      \n      // If regex parsing didn't work well, try alternative parsing\n      if (!executiveSummary && !approach && !budgetDetails && !timeline) {\n        console.log('⚠️ Primary regex parsing failed, trying alternative parsing');\n        \n        // Split by numbered sections or headers\n        const sections = aiContent.split(/\\n\\s*(?:\\d+\\.\\s*)?(?:Executive Summary|Approach|Budget|Timeline|Methodology|Schedule)/i);\n        \n        if (sections.length > 1) {\n          executiveSummary = sections[1]?.trim() || '';\n          approach = sections[2]?.trim() || '';\n          budgetDetails = sections[3]?.trim() || '';\n          timeline = sections[4]?.trim() || '';\n        } else {\n          // Last resort: use the full content as executive summary\n          console.log('⚠️ Alternative parsing failed, using full content as executive summary');\n          executiveSummary = aiContent;\n        }\n      }\n      \n      // Clean up the content by removing extra whitespace and formatting\n      const cleanContent = (content: string) => {\n        return content\n          .replace(/\\n\\s*\\n\\s*\\n/g, '\\n\\n') // Remove excessive line breaks\n          .replace(/^\\s+|\\s+$/g, '') // Trim whitespace\n          .replace(/\\*\\*(.*?)\\*\\*/g, '$1') // Remove bold formatting\n          .replace(/\\*(.*?)\\*/g, '$1'); // Remove italic formatting\n      };\n      \n      executiveSummary = cleanContent(executiveSummary);\n      approach = cleanContent(approach);\n      budgetDetails = cleanContent(budgetDetails);\n      timeline = cleanContent(timeline);\n      \n      console.log('📋 Parsed sections:', {\n        executiveSummary: executiveSummary.substring(0, 150) + (executiveSummary.length > 150 ? '...' : ''),\n        approach: approach.substring(0, 150) + (approach.length > 150 ? '...' : ''),\n        budgetDetails: budgetDetails.substring(0, 150) + (budgetDetails.length > 150 ? '...' : ''),\n        timeline: timeline.substring(0, 150) + (timeline.length > 150 ? '...' : '')\n      });\n      \n      setProposal({\n        ...proposal,\n        content: {\n          ...proposal.content,\n          executiveSummary,\n          approach,\n          budgetDetails,\n          timeline,\n        },\n      });\n      \n      toast.success('Proposal content generated successfully!');\n    } catch (error: any) {\n      console.error('❌ Content generation error:', error);\n      console.error('❌ Error details:', {\n        message: error.message,\n        stack: error.stack,\n        response: error.response\n      });\n      toast.error(error.message || 'Failed to generate proposal content');\n    } finally {\n      setGenerating(false);\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      setLoading(true);\n      \n      const proposalData = {\n        ...proposal,\n        // teamId: selectedTeamId, // teamId is not used\n      };\n      \n      if (isNewProposal) {\n        // Create new proposal\n        await proposalsAPI.create(proposalData);\n        toast.success('Proposal created successfully!');\n        navigate('/proposals');\n      } else {\n        // Update existing proposal\n        await proposalsAPI.update(id!, proposalData);\n        toast.success('Proposal updated successfully!');\n      }\n      \n      navigate('/proposals');\n    } catch (error: any) {\n      console.error('Save error:', error);\n      toast.error(error.response?.data?.error || 'Failed to save proposal');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmit = async () => {\n    try {\n      setLoading(true);\n      \n      const proposalData = {\n        ...proposal,\n        // teamId: selectedTeamId, // teamId is not used\n        status: 'IN_REVIEW'\n      };\n      \n      if (isNewProposal) {\n        // Create and submit new proposal\n        await proposalsAPI.create(proposalData);\n        toast.success('Proposal submitted successfully!');\n        navigate('/proposals');\n      } else {\n        // Update and submit existing proposal\n        await proposalsAPI.update(id!, proposalData);\n        toast.success('Proposal submitted successfully!');\n        navigate('/proposals');\n      }\n    } catch (error: any) {\n      console.error('Submit error:', error);\n      toast.error(error.response?.data?.error || 'Failed to submit proposal');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleClientSelect = (client: any) => {\n    setProposal({\n      ...proposal,\n      clientName: client.name,\n      clientEmail: client.email || '',\n    });\n    setSelectedClientId(client.id);\n    toast.success(`Selected client: ${client.name}`);\n  };\n\n  const handleClearClient = () => {\n    setProposal({\n      ...proposal,\n      clientName: '',\n      clientEmail: '',\n    });\n    setSelectedClientId(undefined);\n    toast.success('Client selection cleared');\n  };\n\n  const handleGrantAccess = async (requestId: string) => {\n    setGrantingRequestId(requestId);\n    try {\n      await proposalsAPI.grantAccessRequest(id!, requestId);\n      toast.success('Access granted and email sent!');\n      // Refresh access requests\n      const { data } = await proposalsAPI.getAccessRequests(id!);\n      setAccessRequests(data.data);\n    } catch (error) {\n      toast.error('Failed to grant access');\n    } finally {\n      setGrantingRequestId(null);\n    }\n  };\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const handleRefineEntireProposal = async () => {\n    try {\n      setGenerating(true);\n      const messages = [\n        {\n          role: 'system',\n          content: `You are an expert proposal writer. Refine the entire proposal content. Make it more detailed, persuasive, and comprehensive.`,\n        },\n        {\n          role: 'user',\n          content: `Current Proposal Content:\\n\\n${proposal.content.fullProposal || getCombinedProposalContent()}`,\n        },\n      ];\n      const result = await getOpenRouterChatCompletion(messages);\n      const refinedContent = result.choices?.[0]?.message?.content || '';\n      setProposal({\n        ...proposal,\n        content: {\n          ...proposal.content,\n          fullProposal: refinedContent,\n        },\n      });\n      toast.success('Entire proposal refined successfully!');\n    } catch (error: any) {\n      console.error('❌ Refine entire proposal error:', error);\n      toast.error(error.message || 'Failed to refine entire proposal');\n    } finally {\n      setGenerating(false);\n    }\n  };\n\n  const handleFormatProposal = () => {\n    const content = proposal.content.fullProposal || getCombinedProposalContent();\n    let formattedContent = '';\n\n    // Split content into sections\n    const sections = content.split(/^(#+)\\s*(.*)$/m);\n    let i = 0;\n    while (i < sections.length) {\n      const level = sections[i].match(/^#+/)?.[0].length || 0;\n      const title = sections[i + 1];\n      const text = sections[i + 2];\n\n      if (level === 1) {\n        formattedContent += `# ${title}\\n\\n${text}\\n\\n`;\n      } else if (level === 2) {\n        formattedContent += `## ${title}\\n\\n${text}\\n\\n`;\n      } else if (level === 3) {\n        formattedContent += `### ${title}\\n\\n${text}\\n\\n`;\n      } else {\n        formattedContent += `${text}\\n\\n`; // For paragraphs or other text\n      }\n      i += 3; // Move to the next section\n    }\n\n    setProposal({\n      ...proposal,\n      content: {\n        ...proposal.content,\n        fullProposal: formattedContent.trim(),\n      },\n    });\n    toast.success('Proposal content formatted!');\n  };\n\n  const getCombinedProposalContent = () => {\n    return `${proposal?.content?.executiveSummary || ''}\\n\\n# Approach\\n\\n${proposal?.content?.approach || ''}\\n\\n# Budget Details\\n\\n${proposal?.content?.budgetDetails || ''}\\n\\n# Timeline\\n\\n${proposal?.content?.timeline || ''}\\n\\n# Additional Sections\\n\\n${proposal?.content?.additionalSections || ''}`;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"animate-spin rounded-full h-20 w-20 border-b-4 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Main Content Flex Layout */}\n      <div className=\"flex flex-1 min-h-0\">\n        {/* Left Sidebar */}\n        <aside className=\"w-[380px] min-w-[380px] max-w-[380px] bg-white border-r border-gray-200 flex flex-col p-8\">\n          {/* Access Requests UI (for owner) */}\n          {accessRequests.length > 0 && (\n            <div className=\"mt-8\">\n              <h3 className=\"text-lg font-bold mb-2 text-blue-700\">Access Requests</h3>\n              <ul className=\"space-y-4\">\n                {accessRequests.map((req) => (\n                  <li key={req.id} className=\"bg-blue-50 rounded-lg p-4 flex flex-col md:flex-row md:items-center md:justify-between border border-blue-100\">\n                    <div>\n                      <div className=\"font-semibold text-blue-900\">{req.name} ({req.email})</div>\n                      <div className=\"text-sm text-gray-700\">{req.company}</div>\n                      <div className=\"text-xs text-gray-500\">{req.reason}</div>\n                      <div className=\"text-xs text-gray-400 mt-1\">Requested: {new Date(req.createdAt).toLocaleString()}</div>\n                      {req.status === 'GRANTED' && req.accessCode && (\n                        <div className=\"text-green-700 text-xs mt-1\">Granted: {req.accessCode}</div>\n                      )}\n                    </div>\n                    {req.status === 'PENDING' && (\n                      <button\n                        className=\"mt-2 md:mt-0 px-4 py-2 bg-gradient-to-r from-blue-600 to-green-500 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-green-600 transition disabled:opacity-50\"\n                        disabled={grantingRequestId === req.id}\n                        onClick={() => handleGrantAccess(req.id)}\n                      >\n                        {grantingRequestId === req.id ? 'Granting...' : 'Grant Access'}\n                      </button>\n                    )}\n                    {req.status === 'GRANTED' && (\n                      <span className=\"ml-2 text-green-600 font-semibold\">Granted</span>\n                    )}\n                    {req.status === 'DENIED' && (\n                      <span className=\"ml-2 text-red-600 font-semibold\">Denied</span>\n                    )}\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-8\">\n            {isNewProposal ? 'Create New Proposal' : 'Edit Proposal'}\n          </h2>\n          <form className=\"space-y-8\">\n                              <div>\n                  <label className=\"block text-sm font-semibold text-gray-700 mb-3\">\n                    Proposal Title <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={proposal?.title || ''}\n                    onChange={(e) => setProposal({ ...proposal, title: e.target.value })}\n                    className=\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\n                    placeholder=\"Enter proposal title\"\n                  />\n                </div>\n                              <div>\n                  <label className=\"block text-sm font-semibold text-gray-700 mb-3\">\n                    Client Name <span className=\"text-red-500\">*</span>\n                  </label>\n                  <div className=\"flex gap-3\">\n                    <input\n                      type=\"text\"\n                      value={proposal?.clientName || ''}\n                      onChange={(e) => setProposal({ ...proposal, clientName: e.target.value })}\n                      className=\"flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\n                      placeholder=\"Enter client name\"\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowClientModal(true)}\n                      className={`px-6 py-3 rounded-xl transition-all duration-200 flex items-center gap-2 whitespace-nowrap font-medium ${\n                        selectedClientId \n                          ? 'bg-green-600 text-white hover:bg-green-700 shadow-md' \n                          : 'bg-blue-600 text-white hover:bg-blue-700 shadow-md'\n                      }`}\n                    >\n                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\n                      </svg>\n                      {selectedClientId ? 'Change' : 'Select'}\n                    </button>\n                  </div>\n                {selectedClientId && (\n                  <div className=\"mt-2 p-2 bg-green-50 border border-green-200 rounded-lg\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2 text-sm text-green-800\">\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                        </svg>\n                        Client selected from database\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={handleClearClient}\n                        className=\"text-red-600 hover:text-red-800 text-sm font-medium\"\n                      >\n                        Clear\n                      </button>\n                    </div>\n                  </div>\n                )}\n              </div>\n                              <div>\n                  <label className=\"block text-sm font-semibold text-gray-700 mb-3\">\n                    Description <span className=\"text-red-500\">*</span>\n                  </label>\n                  <textarea\n                    value={proposal?.description || ''}\n                    onChange={(e) => setProposal({ ...proposal, description: e.target.value })}\n                    rows={6}\n                    className=\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200\"\n                    placeholder=\"Describe the project, requirements, and objectives...\"\n                  />\n                </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-semibold text-gray-700 mb-3\">Budget</label>\n                  <input\n                    type=\"text\"\n                    value={proposal?.content?.budget || ''}\n                    onChange={(e) => setProposal({ ...proposal, content: { ...proposal?.content, budget: e.target.value } })}\n                    className=\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\n                    placeholder=\"e.g., $50,000\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-semibold text-gray-700 mb-3\">Timeline</label>\n                  <input\n                    type=\"text\"\n                    value={proposal?.content?.timeline || ''}\n                    onChange={(e) => setProposal({ ...proposal, content: { ...proposal?.content, timeline: e.target.value } })}\n                    className=\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\n                    placeholder=\"e.g., 3 months\"\n                  />\n                </div>\n              </div>\n              <div>\n                <label className=\"block text-sm font-semibold text-gray-700 mb-3\">Industry</label>\n                <input\n                  type=\"text\"\n                  value={proposal?.metadata?.industry || ''}\n                  onChange={(e) => setProposal({ ...proposal, metadata: { ...proposal?.metadata, industry: e.target.value } })}\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200\"\n                  placeholder=\"e.g., Technology, Healthcare, Finance\"\n                />\n              </div>\n              {/* Action Buttons */}\n              <div className=\"flex gap-3 pt-6\">\n                <button\n                  type=\"button\"\n                  onClick={handleSave}\n                  disabled={loading}\n                  className=\"flex-1 px-4 py-3 bg-gray-600 text-white font-medium rounded-xl hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 transition-all duration-200\"\n                >\n                  Save Draft\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={handleSubmit}\n                  disabled={loading}\n                  className=\"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 transition-all duration-300 transform hover:scale-105\"\n                >\n                  Submit Proposal\n                </button>\n              </div>\n              <button\n                type=\"button\"\n                onClick={handleGenerateWithAI}\n                disabled={generating || loading || !proposal?.clientName || !proposal?.description}\n                className={`w-full mt-8 py-4 px-6 rounded-xl font-semibold text-white transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 shadow-lg ${\n                  generating || loading || !proposal?.clientName || !proposal?.description\n                    ? 'bg-gray-400 cursor-not-allowed'\n                    : 'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 focus:ring-blue-500'\n                }`}\n              >\n                {generating ? (\n                  <div className=\"flex items-center justify-center\">\n                    <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                    </svg>\n                    Generating Content...\n                  </div>\n                ) : (\n                  <div className=\"flex items-center justify-center\">\n                    <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                    </svg>\n                    Generate AI Content\n                  </div>\n                )}\n              </button>\n              {(!proposal?.clientName || !proposal?.description) && (\n                <p className=\"text-sm text-gray-500 text-center mt-2\">\n                  Enter client name and description to enable AI generation\n                </p>\n              )}\n          </form>\n        </aside>\n        {/* Right Content Area */}\n        <main className=\"flex-1 flex flex-col p-12 overflow-y-auto bg-gray-50\">\n          <div className=\"mb-8\">\n            <h2 className=\"text-3xl font-bold text-gray-900 mb-2\">Proposal Content</h2>\n            <p className=\"text-gray-600\">Review, edit, and refine your proposal content</p>\n          </div>\n          \n          {/* Access Requests Section */}\n          {(accessRequests.length > 0 || isNewProposal) && (\n            <div className=\"mb-8 bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-xl font-bold mb-4 text-blue-700 flex items-center gap-2\">\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\" />\n                </svg>\n                Access Requests ({accessRequests.length > 0 ? accessRequests.length : 1})\n              </h3>\n              <div className=\"space-y-4\">\n                {accessRequests.length > 0 ? (\n                  accessRequests.map((req) => (\n                    <div key={req.id} className=\"bg-blue-50 rounded-lg p-4 border border-blue-100\">\n                      <div className=\"flex justify-between items-start\">\n                        <div className=\"flex-1\">\n                          <div className=\"font-semibold text-blue-900\">{req.name} ({req.email})</div>\n                          <div className=\"text-sm text-gray-700\">{req.company}</div>\n                          <div className=\"text-xs text-gray-500 mt-1\">{req.reason}</div>\n                          <div className=\"text-xs text-gray-400 mt-1\">Requested: {new Date(req.createdAt).toLocaleString()}</div>\n                          {req.status === 'GRANTED' && req.accessCode && (\n                            <div className=\"text-green-700 text-xs mt-1 font-medium\">Access Code: {req.accessCode}</div>\n                          )}\n                        </div>\n                        <div className=\"ml-4\">\n                          {req.status === 'PENDING' && (\n                            <button\n                              className=\"px-4 py-2 bg-gradient-to-r from-blue-600 to-green-500 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-green-600 transition disabled:opacity-50 text-sm\"\n                              disabled={grantingRequestId === req.id}\n                              onClick={() => handleGrantAccess(req.id)}\n                            >\n                              {grantingRequestId === req.id ? 'Granting...' : 'Grant Access'}\n                            </button>\n                          )}\n                          {req.status === 'GRANTED' && (\n                            <span className=\"text-green-600 font-semibold text-sm\">✓ Granted</span>\n                          )}\n                          {req.status === 'DENIED' && (\n                            <span className=\"text-red-600 font-semibold text-sm\">✗ Denied</span>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))\n                ) : (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <div className=\"text-lg font-medium mb-2\">No Access Requests</div>\n                    <div className=\"text-sm\">When clients request access to this proposal, they will appear here.</div>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          <div className=\"max-h-[700px] min-h-[300px] flex-1 overflow-y-auto pr-2\">\n              {generating ? (\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"relative\">\n                    {/* Animated circles */}\n                    <div className=\"absolute inset-0 animate-ping\">\n                      <div className=\"w-16 h-16 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full opacity-20\"></div>\n                    </div>\n                    <div className=\"absolute inset-0 animate-ping\" style={{ animationDelay: '0.5s' }}>\n                      <div className=\"w-16 h-16 bg-gradient-to-r from-green-400 to-blue-500 rounded-full opacity-20\"></div>\n                    </div>\n                    <div className=\"relative\">\n                      <div className=\"w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center\">\n                        <svg className=\"w-8 h-8 text-white animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                        </svg>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"mt-6 text-center\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Generating Your Proposal</h3>\n                    <p className=\"text-gray-600\">Our AI is crafting a professional proposal tailored to your needs...</p>\n                    \n                    {/* Animated dots */}\n                    <div className=\"flex justify-center mt-4 space-x-1\">\n                      <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\"></div>\n                      <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                      <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"space-y-6\">\n                  {/* Single Unified Proposal Editor */}\n                  <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                    <div className=\"flex justify-between items-center mb-6\">\n                      <h3 className=\"text-xl font-bold text-gray-900 flex items-center gap-2\">\n                        <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                        </svg>\n                        Proposal Content Editor\n                      </h3>\n                      <div className=\"flex gap-3\">\n                        <button \n                          onClick={() => handleRefineEntireProposal()}\n                          className=\"px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition flex items-center gap-2\"\n                        >\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                          </svg>\n                          Refine with AI\n                        </button>\n                        <button \n                          onClick={() => handleFormatProposal()}\n                          className=\"px-4 py-2 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700 transition flex items-center gap-2\"\n                        >\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n                          </svg>\n                          Format\n                        </button>\n                      </div>\n                    </div>\n                    \n                    <div className=\"mb-4\">\n                      <div className=\"flex items-center gap-4 text-sm text-gray-600 mb-2\">\n                        <span className=\"flex items-center gap-1\">\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                          </svg>\n                          Edit the entire proposal content below\n                        </span>\n                        <span className=\"flex items-center gap-1\">\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                          </svg>\n                          Use \"Refine with AI\" to improve the entire document\n                        </span>\n                      </div>\n                    </div>\n\n                    <textarea\n                      value={proposal?.content?.fullProposal || getCombinedProposalContent()}\n                      onChange={(e) => setProposal({ \n                        ...proposal, \n                        content: { \n                          ...proposal?.content, \n                          fullProposal: e.target.value \n                        } \n                      })}\n                      rows={25}\n                      className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200 bg-gray-50 font-mono text-sm leading-relaxed\"\n                      placeholder=\"Enter your complete proposal content here...\n\n# Executive Summary\n[Your executive summary goes here]\n\n# Approach\n[Your approach and methodology]\n\n# Budget Details\n[Detailed budget breakdown]\n\n# Timeline\n[Project timeline and milestones]\n\n# Additional Sections\n[Any other relevant sections]\"\n                    />\n                    \n                    <div className=\"mt-4 flex items-center justify-between text-xs text-gray-500\">\n                      <span>Word count: {proposal?.content?.fullProposal?.split(/\\s+/).length || 0} words</span>\n                      <span>Characters: {proposal?.content?.fullProposal?.length || 0}</span>\n                    </div>\n                  </div>\n\n                  {/* Success Message */}\n                  <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n                    <div className=\"flex items-center gap-2 text-green-800\">\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                      </svg>\n                      <span className=\"font-medium\">Content Generated Successfully!</span>\n                    </div>\n                    <p className=\"text-green-700 text-sm mt-1\">Review and edit the content above. Use \"Refine with AI\" to improve the entire document or \"Format\" to structure it properly.</p>\n                  </div>\n                </div>\n              )}\n            </div>\n        </main>\n      </div>\n      \n      {/* Client Selection Modal */}\n      <ClientSelectionModal\n        isOpen={showClientModal}\n        onClose={() => setShowClientModal(false)}\n        onSelectClient={handleClientSelect}\n        selectedClientId={selectedClientId}\n      />\n    </div>\n  );\n};\n\nexport default ProposalEditor; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}